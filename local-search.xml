<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>SDLå­¦ä¹ -é›¨æ»´æ•ˆæœ</title>
    <link href="/2025/03/16/SDL%E5%AD%A6%E4%B9%A0-%E9%9B%A8%E6%BB%B4%E6%95%88%E6%9E%9C/"/>
    <url>/2025/03/16/SDL%E5%AD%A6%E4%B9%A0-%E9%9B%A8%E6%BB%B4%E6%95%88%E6%9E%9C/</url>
    
    <content type="html"><![CDATA[<p><img src="/Users/yuhong/Desktop/blog/hexo-blog/source/images/output1.gif" alt="output1"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;SDL2/SDL.h&quot;</span></span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> WINDOW_W 800</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> WINDOW_H 600</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-type">int</span> x;<br>    <span class="hljs-type">int</span> y;<br>    <span class="hljs-type">int</span> r;<br>    <span class="hljs-type">int</span> speed;<br>    <span class="hljs-type">int</span> alpha;<br>&#125; Spot;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">initSpot</span><span class="hljs-params">(Spot* spot)</span> </span>&#123;<br>    spot-&gt;y = <span class="hljs-built_in">rand</span>() % WINDOW_H;<br>    spot-&gt;x = <span class="hljs-built_in">rand</span>() % WINDOW_W;<br>    spot-&gt;r = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">4</span> + <span class="hljs-number">1</span>;<br>    spot-&gt;speed = <span class="hljs-number">6</span> - spot-&gt;r;<br>    spot-&gt;alpha = <span class="hljs-built_in">rand</span>()%<span class="hljs-number">255</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">drawSpot</span><span class="hljs-params">(Spot* spot, SDL_Renderer* rend, SDL_Texture* circle)</span> </span>&#123;<br>    SDL_Rect rect = &#123;spot-&gt;x, spot-&gt;y, spot-&gt;r, spot-&gt;r&#125;;<br>    <span class="hljs-built_in">SDL_SetTextureAlphaMod</span>(circle, spot-&gt;alpha);<br>    <span class="hljs-built_in">SDL_RenderCopy</span>(rend, circle, <span class="hljs-literal">NULL</span>, &amp;rect);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">moveSpot</span><span class="hljs-params">(Spot* spot)</span> </span>&#123;<br>    spot-&gt;y += spot-&gt;speed;<br>    <span class="hljs-keyword">if</span> (spot-&gt;y &gt;= WINDOW_H) &#123;<br>        <span class="hljs-built_in">initSpot</span>(spot);<br>        spot-&gt;y = <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">drawRain</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">SDL_Init</span>(SDL_INIT_EVERYTHING);<br>    SDL_Window* window = <span class="hljs-built_in">SDL_CreateWindow</span>(<span class="hljs-string">&quot;drawRain&quot;</span>, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED,<br>                                          WINDOW_W, WINDOW_H, SDL_WINDOW_SHOWN | SDL_WINDOW_BORDERLESS);<br>    SDL_Renderer* rend = <span class="hljs-built_in">SDL_CreateRenderer</span>(window, <span class="hljs-number">-1</span>, SDL_RENDERER_SOFTWARE);<br>    SDL_Surface* bgSurface = <span class="hljs-built_in">SDL_LoadBMP</span>(<span class="hljs-string">&quot;/Users/yuhong/Desktop/SDLLearn/res/bg.bmp&quot;</span>);<br>    SDL_Surface* circleSurface = <span class="hljs-built_in">SDL_LoadBMP</span>(<span class="hljs-string">&quot;/Users/yuhong/Desktop/SDLLearn/res/circle.bmp&quot;</span>);<br>    <span class="hljs-built_in">SDL_SetColorKey</span>(circleSurface, SDL_TRUE, <span class="hljs-built_in">SDL_MapRGB</span>(circleSurface-&gt;format, <span class="hljs-number">104</span>, <span class="hljs-number">123</span>, <span class="hljs-number">154</span>));<br><br>    SDL_Texture* bg = <span class="hljs-built_in">SDL_CreateTextureFromSurface</span>(rend, bgSurface);<br>    SDL_Texture* circle = <span class="hljs-built_in">SDL_CreateTextureFromSurface</span>(rend, circleSurface);<br>    <span class="hljs-built_in">SDL_SetTextureBlendMode</span>(bg, SDL_BLENDMODE_BLEND);<br>    <span class="hljs-built_in">SDL_SetTextureBlendMode</span>(circle, SDL_BLENDMODE_BLEND);<br><br>    <span class="hljs-built_in">SDL_SetTextureAlphaMod</span>(bg, <span class="hljs-number">100</span>);<br>    <span class="hljs-built_in">SDL_SetTextureColorMod</span>(circle, <span class="hljs-number">166</span>, <span class="hljs-number">250</span>,<span class="hljs-number">250</span>);<br><br>    SDL_Rect rectWindow;<br>    SDL_Rect rect;<br><br>    rectWindow.x = <span class="hljs-number">0</span>;<br>    rectWindow.y = <span class="hljs-number">0</span>;<br>    rectWindow.w = WINDOW_W;<br>    rectWindow.h = WINDOW_H;<br><br>    rect.x = <span class="hljs-number">0</span>;<br>    rect.y = <span class="hljs-number">0</span>;<br>    rect.w = circleSurface-&gt;w;<br>    rect.h = circleSurface-&gt;h;<br><br>    <span class="hljs-built_in">SDL_SetRenderDrawColor</span>(rend, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>);<br>    <span class="hljs-built_in">SDL_RenderClear</span>(rend);<br>    <span class="hljs-built_in">SDL_RenderPresent</span>(rend);<br><br>    <span class="hljs-type">int</span> spotCount = <span class="hljs-number">100</span>;<br>    Spot spots[spotCount];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; spotCount; ++i) &#123;<br>        <span class="hljs-built_in">initSpot</span>(&amp;spots[i]);<br>    &#125;<br><br>    SDL_Event event;<br>    <span class="hljs-type">bool</span> quit = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">while</span> (!quit) &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">SDL_PollEvent</span>(&amp;event)) &#123;<br>            <span class="hljs-comment">// printf(&quot;get event %d\n&quot;, event.type);</span><br>            <span class="hljs-keyword">if</span> (event.type == SDL_QUIT) &#123;<br>                quit = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.type == SDL_KEYDOWN) &#123;<br>                <span class="hljs-keyword">if</span> (event.key.keysym.sym == SDLK_ESCAPE) &#123;<br>                    quit = <span class="hljs-literal">true</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-built_in">SDL_RenderCopy</span>(rend, bg, <span class="hljs-literal">NULL</span>, &amp;rectWindow);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; spotCount; ++i) &#123;<br>            <span class="hljs-built_in">drawSpot</span>(&amp;spots[i], rend, circle);<br>            <span class="hljs-built_in">moveSpot</span>(&amp;spots[i]);<br>        &#125;<br>        <span class="hljs-built_in">SDL_RenderPresent</span>(rend);<br><br>        <span class="hljs-built_in">SDL_Delay</span>(<span class="hljs-number">10</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">SDL_DestroyRenderer</span>(rend);<br>    <span class="hljs-built_in">SDL_DestroyWindow</span>(window);<br>    <span class="hljs-built_in">SDL_Quit</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> </span>&#123;<br>    <span class="hljs-built_in">drawRain</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SDL</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SDLå­¦ä¹ -ç”»æ¿</title>
    <link href="/2025/03/16/SDL%E5%AD%A6%E4%B9%A0-%E7%94%BB%E6%9D%BF/"/>
    <url>/2025/03/16/SDL%E5%AD%A6%E4%B9%A0-%E7%94%BB%E6%9D%BF/</url>
    
    <content type="html"><![CDATA[<p><img src="/Users/yuhong/Desktop/blog/hexo-blog/source/images/output.gif" alt="output"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;SDL2/SDL.h&quot;</span></span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> WINDOW_W 800</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> WINDOW_H 600</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">drawLine</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">SDL_Init</span>(SDL_INIT_VIDEO);<br>    SDL_Window* window = <span class="hljs-built_in">SDL_CreateWindow</span>(<span class="hljs-string">&quot;drawLine&quot;</span>, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED,<br>                                          WINDOW_W, WINDOW_H, SDL_WINDOW_SHOWN);<br>    SDL_Renderer* rend = <span class="hljs-built_in">SDL_CreateRenderer</span>(window, <span class="hljs-number">-1</span>, SDL_RENDERER_SOFTWARE);<br>    <span class="hljs-built_in">SDL_SetRenderDrawBlendMode</span>(rend, SDL_BLENDMODE_BLEND);<br><br>    <span class="hljs-built_in">SDL_SetRenderDrawColor</span>(rend, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>);<br>    <span class="hljs-built_in">SDL_RenderClear</span>(rend);<br>    <span class="hljs-built_in">SDL_RenderPresent</span>(rend);<br><br>    <span class="hljs-built_in">SDL_SetRenderDrawColor</span>(rend, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>);<br><br>    <span class="hljs-type">bool</span> mousePressed = <span class="hljs-literal">false</span>;<br>    <span class="hljs-type">int</span> lastMouseX = <span class="hljs-number">-1</span>;<br>    <span class="hljs-type">int</span> lastMouseY = <span class="hljs-number">-1</span>;<br><br>    SDL_Event event;<br>    <span class="hljs-type">bool</span> quit = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">while</span> (!quit) &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">SDL_PollEvent</span>(&amp;event)) &#123;<br>            <span class="hljs-comment">// printf(&quot;get event %d\n&quot;, event.type);</span><br>            <span class="hljs-keyword">if</span> (event.type == SDL_QUIT) &#123;<br>                quit = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.type == SDL_KEYDOWN) &#123;<br>                <span class="hljs-keyword">if</span> (event.key.keysym.sym == SDLK_ESCAPE) &#123;<br>                    quit = <span class="hljs-literal">true</span>;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.type == SDL_MOUSEBUTTONDOWN) &#123;<br>                mousePressed = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.type == SDL_MOUSEBUTTONUP) &#123;<br>                mousePressed = <span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.type == SDL_MOUSEMOTION) &#123;<br>                <span class="hljs-type">int</span> x = event.motion.x;<br>                <span class="hljs-type">int</span> y = event.motion.y;<br>                <span class="hljs-keyword">if</span> (mousePressed) &#123;<br>                    <span class="hljs-keyword">if</span> (lastMouseX != <span class="hljs-number">-1</span> &amp;&amp; lastMouseY != <span class="hljs-number">-1</span>) &#123;<br>                        <span class="hljs-built_in">SDL_RenderDrawLine</span>(rend, lastMouseX, lastMouseY, x, y);<br>                        <span class="hljs-built_in">SDL_RenderPresent</span>(rend);<br>                    &#125;<br>                    lastMouseX = x;<br>                    lastMouseY = y;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    lastMouseX = <span class="hljs-number">-1</span>;<br>                    lastMouseY = <span class="hljs-number">-1</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">SDL_Delay</span>(<span class="hljs-number">10</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">SDL_DestroyRenderer</span>(rend);<br>    <span class="hljs-built_in">SDL_DestroyWindow</span>(window);<br>    <span class="hljs-built_in">SDL_Quit</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> </span>&#123;<br>    <span class="hljs-built_in">drawLine</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SDL</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>FFmpegç¼–è¯‘è°ƒè¯•(MacOs M1)</title>
    <link href="/2024/04/20/FFmpeg%E7%BC%96%E8%AF%91%E8%B0%83%E8%AF%95-MacOs-M1/"/>
    <url>/2024/04/20/FFmpeg%E7%BC%96%E8%AF%91%E8%B0%83%E8%AF%95-MacOs-M1/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸‹è½½æºç "><a href="#ä¸‹è½½æºç " class="headerlink" title="ä¸‹è½½æºç "></a>ä¸‹è½½æºç </h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://ffmpeg.org/download.html">https://ffmpeg.org/download.html</a></p><h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><p>è¿›å…¥æºç æ ¹ç›®å½•</p><h3 id="é…ç½®ç¼–è¯‘é€‰é¡¹"><a href="#é…ç½®ç¼–è¯‘é€‰é¡¹" class="headerlink" title="é…ç½®ç¼–è¯‘é€‰é¡¹"></a>é…ç½®ç¼–è¯‘é€‰é¡¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">./configure \--prefix=/usr/local \<br> --enable-gpl \<br> --enable-version3 \<br> --enable-nonfree \<br> --enable-static \<br> --disable-shared \<br> --enable-debug=3 \<br> --enable-pthreads \<br> --enable-ffplay \<br> --enable-ffprobe \<br> --enable-libx264 \<br> --enable-libx265 \<br> --extra-cflags=<span class="hljs-string">&quot;-I/usr/local/include&quot;</span> \<br> --extra-ldflags=<span class="hljs-string">&quot;-L/usr/local/lib&quot;</span> \<br> --<span class="hljs-built_in">arch</span>=arm64 \<br> --enable-videotoolbox \<br> --disable-optimizations \<br> --disable-asm \<br> --disable-stripping<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„é…ç½®é€‰é¡¹åŒ…æ‹¬ï¼š</p><ul><li><code>--enable-gpl</code> å’Œ <code>--enable-version3</code>ï¼šå¯ç”¨GPLå’Œç‰ˆæœ¬3çš„åŠŸèƒ½ï¼Œè¿™é€šå¸¸æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºä¸€äº›ç¼–è§£ç åº“å¦‚x264æ˜¯åœ¨GPLä¸‹å‘å¸ƒçš„ã€‚</li><li><code>--enable-static</code> å’Œ <code>--disable-shared</code>ï¼šç”Ÿæˆé™æ€åº“ï¼Œä¸ç”ŸæˆåŠ¨æ€åº“ã€‚</li><li><code>--enable-debug=3</code>ï¼šå¯ç”¨é«˜çº§åˆ«çš„è°ƒè¯•ä¿¡æ¯ã€‚</li><li><code>--arch=arm64</code>ï¼šä¸ºM1èŠ¯ç‰‡æŒ‡å®šæ¶æ„ã€‚</li><li><code>--enable-ffplay</code>ï¼šç”Ÿæˆffplay</li><li><code>--enable-ffprobe</code>ï¼šç”Ÿæˆffprobe</li></ul><h3 id="ç¼–è¯‘FFmpeg"><a href="#ç¼–è¯‘FFmpeg" class="headerlink" title="ç¼–è¯‘FFmpeg"></a>ç¼–è¯‘FFmpeg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">make -j$(sysctl -n hw.logicalcpu)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šæ ¹æ®ä½ çš„CPUæ ¸å¿ƒæ•°å¹¶è¡Œç¼–è¯‘ï¼Œä»¥åŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚</p><p>ä¼šç”Ÿæˆffmpegã€ffmpeg_gã€ffplayã€ffplay_gã€ffprobeã€ffprobe_gã€‚å…¶ä¸­åé¢æœ‰ <code>_g</code> çš„ä»£è¡¨æœ‰è°ƒè¯•ç¬¦å·ï¼Œæ²¡æœ‰ <code>_g</code> çš„æ˜¯è¿›è¡Œäº† <code>strip</code> æ“ä½œï¼ŒæŠŠè°ƒè¯•ä¿¡æ¯å»æ‰äº†ï¼Œè¦é€‰æ‹© _g åç¼€çš„å¯æ‰§è¡Œæ–‡ä»¶æ¥è°ƒè¯•</p><p><img src="/../images/image-20240420134006206.png" alt="image-20240420134006206"></p><h3 id="å®‰è£…FFmpeg"><a href="#å®‰è£…FFmpeg" class="headerlink" title="å®‰è£…FFmpeg"></a>å®‰è£…FFmpeg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo make install<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå°†FFmpegå®‰è£…åˆ°<code>/usr/local</code>ç›®å½•ä¸‹ã€‚</p><h3 id="éªŒè¯å®‰è£…"><a href="#éªŒè¯å®‰è£…" class="headerlink" title="éªŒè¯å®‰è£…"></a>éªŒè¯å®‰è£…</h3><p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥å®‰è£…çš„ç‰ˆæœ¬ï¼Œç¡®è®¤æ˜¯å¦æ­£ç¡®å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ffmpeg -version<br>ffplay -version<br>ffprobe -version<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨CLionè°ƒè¯•"><a href="#ä½¿ç”¨CLionè°ƒè¯•" class="headerlink" title="ä½¿ç”¨CLionè°ƒè¯•"></a>ä½¿ç”¨CLionè°ƒè¯•</h2><ul><li><p>ä¸‹è½½CLionï¼š<a href="https://www.jetbrains.com/zh-cn/clion/download/">https://www.jetbrains.com/zh-cn/clion/download/</a></p></li><li><p>æ‰“å¼€FFmpegæºç ç›®å½•</p></li><li><p>å³ä¸Šè§’ Edit Configurations é…ç½®è°ƒè¯•ç›®æ ‡å’Œå‚æ•°</p><p><img src="/../images/image-20240420133328750.png" alt="image-20240420133328750"></p></li><li><p>ä»¥ffplayçš„è°ƒè¯•ä¸ºä¾‹ï¼š</p><p><img src="/../images/image-20240420134508471.png" alt="image-20240420134508471"></p></li><li><p>æ‰¾åˆ°ffplayæºç ï¼Œä½äº <code>fftools/ffplay.c</code>ï¼Œå¢åŠ æ–­ç‚¹ï¼Œç„¶åç‚¹å‡»å³ä¸Šè§’è°ƒè¯•</p><p><img src="/../images/image-20240420134800310.png" alt="image-20240420134800310"></p></li></ul><p>å‚è€ƒï¼š<a href="https://ffmpeg.xianwaizhiyin.net/debug-ffmpeg/ubuntu18-clion.html">https://ffmpeg.xianwaizhiyin.net/debug-ffmpeg/ubuntu18-clion.html</a></p>]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>FFmpeg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœç´¢æŠ€æœ¯</title>
    <link href="/2023/11/18/%E6%90%9C%E7%B4%A2%E6%8A%80%E6%9C%AF/"/>
    <url>/2023/11/18/%E6%90%9C%E7%B4%A2%E6%8A%80%E6%9C%AF/</url>
    
    <content type="html"><![CDATA[<p>åŸè§†é¢‘ï¼š<a href="https://www.youtube.com/watch?v=tiN6T1LewmQ">https://www.youtube.com/watch?v=tiN6T1LewmQ</a></p><h2 id="æœç´¢æŠ€æœ¯çš„é‡è¦æ€§"><a href="#æœç´¢æŠ€æœ¯çš„é‡è¦æ€§" class="headerlink" title="æœç´¢æŠ€æœ¯çš„é‡è¦æ€§"></a>æœç´¢æŠ€æœ¯çš„é‡è¦æ€§</h2><ol><li>æœç´¢æŠ€æœ¯æ˜¯æ™®é€šäººå˜å¼ºçš„å”¯ä¸€å¤–æŒ‚,å¯ä»¥å¸®åŠ©äººä»¬å­¦ä¹ çš„æ¯”åˆ«äººå¿«,åšçš„æ¯”åˆ«äººå¥½ã€‚ </li><li>æŒæ¡æœç´¢æŠ€æœ¯æ˜¯äº’è”ç½‘æ—¶ä»£è·å–ä¿¡æ¯çš„å…³é”®,å¯ä»¥æå¤§ç¨‹åº¦åœ°ç¼©å°ä¿¡æ¯å·®è·</li></ol><h2 id="æœç´¢æŠ€æœ¯çš„åˆ†ç±»"><a href="#æœç´¢æŠ€æœ¯çš„åˆ†ç±»" class="headerlink" title="æœç´¢æŠ€æœ¯çš„åˆ†ç±»"></a>æœç´¢æŠ€æœ¯çš„åˆ†ç±»</h2><ol><li><p>æœç´¢ç›®çš„å¯åˆ†ä¸º4ç±»:  </p><p> (1) äº†è§£ä¿¡æ¯(Know Something)   </p></li></ol><p>â€‹    (2) å­¦ä¹ æŠ€èƒ½(Learn Something)     </p><p>â€‹    (3) åˆ›ä½œå†…å®¹(Create Something)    </p><p>â€‹    (4) å®Œæˆä»»åŠ¡(Do Something) </p><ol start="2"><li>æœç´¢å†…å®¹å¯åˆ†ä¸º4ç±»:  </li></ol><p>â€‹    (1) ä¿¡æ¯èµ„è®¯:æ–°é—»ã€äº‹ä»¶ç­‰  </p><p>â€‹    (2) çŸ¥è¯†æŠ€èƒ½:æ¦‚å¿µã€æ•™ç¨‹ç­‰    </p><p>â€‹    (3) ç´ ææ–‡ä»¶:å›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£ç­‰   </p><p>â€‹    (4) å·¥å…·è½¯ä»¶:å„ç±»å·¥å…·ã€æ’ä»¶ç­‰ </p><h2 id="æœç´¢ä¿¡æ¯èµ„è®¯"><a href="#æœç´¢ä¿¡æ¯èµ„è®¯" class="headerlink" title="æœç´¢ä¿¡æ¯èµ„è®¯"></a>æœç´¢ä¿¡æ¯èµ„è®¯</h2><ol><li>è¦å¿«é€Ÿå‡†ç¡®,è°·æ­Œæ•ˆç‡æœ€é«˜</li><li>å¯è¿ç”¨æœç´¢è¯­æ³•æå‡æ•ˆç‡:<ul><li>é™å®šå…³é”®è¯:ç”¨åŒå¼•å·â€â€åŒ…è£¹   </li><li> é™å®šæ ‡é¢˜:intitle</li><li>é™å®šå†…å®¹:intext</li><li>é™å®šç½‘å€:inurl</li><li>é™å®šç½‘ç«™:site</li><li>é™å®šå›¾ç‰‡å¤§å°:imagesize</li><li>é™å®šæ–‡ä»¶ç±»å‹:filetype</li></ul></li><li>ä¿¡æ¯æºå¤´æœ€å‡†ç¡®å¯ä¿¡ï¼Œè¦æ³¨æ„åˆ¤æ–­æ¥æº</li></ol><h2 id="æœç´¢çŸ¥è¯†æŠ€èƒ½"><a href="#æœç´¢çŸ¥è¯†æŠ€èƒ½" class="headerlink" title="æœç´¢çŸ¥è¯†æŠ€èƒ½"></a>æœç´¢çŸ¥è¯†æŠ€èƒ½</h2><ol><li>ä¸»è¦å¹³å°:è°·æ­Œã€youtubeã€å¾—åˆ°APPã€ä¼˜è´¨è§†é¢‘ç½‘ç«™ç­‰</li><li>æ³¨æ„çŸ¥è¯†è´¨é‡,å°½é‡é‡‡ç”¨ä¸€æ‰‹èµ„æ–™</li><li>å¯ä¸‹è½½ç ”ç©¶æŠ¥å‘Šã€å­¦æœ¯è®ºæ–‡ç­‰é«˜è´¨é‡æ–‡æ¡£</li><li>è§†é¢‘æ•™ç¨‹å¯åœ¨è§†é¢‘ç½‘ç«™ã€çŸ­è§†é¢‘å¹³å°è·å–</li></ol><p>æœç´¢ç½‘é¡µï¼š</p><ul><li>è°·æ­Œ</li><li>å…¬ä¼—å·æ–‡ç« ï¼šæœç‹—æœç´¢ã€å¾®ä¿¡æœä¸€æœ</li><li>å‚ç±»ç¤¾ç¾¤ï¼šGitHubã€stack overflowã€CSDN</li><li>èšåˆç½‘ç«™ï¼šå¯¼èˆªç½‘ç«™</li></ul><p>æœç´¢ç ”ç©¶æŠ¥å‘Šï¼š</p><ul><li>filetypeï¼špdf</li><li>Inure: baogao</li><li>SimilarSitesç½‘ç«™æœç´¢ baogao.comï¼Œå¾—åˆ°ç±»ä¼¼ç½‘ç«™</li></ul><p>æœç´¢å­¦æœ¯è®ºæ–‡ï¼š</p><ul><li><p>ä¸­æ–‡ï¼šæ·˜å®ä¹°è´¦å·æå®š</p></li><li><p>å›½é™…å‰æ²¿ï¼šè°·æ­Œå­¦æœ¯ã€sci-hub</p></li></ul><p>æœç´¢ç”µå­ä¹¦ï¼š</p><ul><li>ä¸­æ–‡ï¼šé¸ æ‘©æœä¹¦</li><li>è‹±æ–‡ï¼šè°·æ­Œ best free ebook download sites</li><li>å¾®ä¿¡è¯»ä¹¦ã€å¾—åˆ°app</li></ul><p>æœç´¢è§†é¢‘ï¼š</p><ul><li>çŸ­è§†é¢‘å¹³å°</li><li>bç«™ã€YouTubeã€ç½‘æ˜“äº‘è¯¾å ‚ã€å¯æ±—å­¦é™¢ã€è…¾è®¯è¯¾å ‚ã€OpenCultureã€edXã€Coursera</li><li>è°·æ­Œ best online learning websites</li><li>ç™¾åº¦ç½‘ç›˜æœç´¢å¼•æ“</li></ul><h2 id="æœç´¢ç´ ææ–‡ä»¶"><a href="#æœç´¢ç´ ææ–‡ä»¶" class="headerlink" title="æœç´¢ç´ ææ–‡ä»¶"></a>æœç´¢ç´ ææ–‡ä»¶</h2><ol><li><p>å¯åˆ©ç”¨å…è´¹ç´ æç½‘ç«™ã€ç‰ˆæƒç½‘ç«™ç­‰</p><ul><li><p>è§†é¢‘ï¼š</p><ul><li><p>ç½‘ç«™ï¼špixelsã€pixabayã€videoã€mixkit</p></li><li><p>è°·æ­Œ best sites for free stock videos</p></li><li><p>youtubeè§†é¢‘ä¸‹è½½ï¼šè§†é¢‘åœ°å€æ youtubeå‰è¾“å…¥9x</p></li><li><p>4kç´ æï¼šSaveTubeã€4k + åŸå¸‚æˆ–å›½å®¶æœç´¢</p></li></ul></li><li><p>éŸ³é¢‘ï¼š</p><ul><li>è°·æ­Œ best site for free bgm</li><li>pixels</li></ul></li><li><p>å›¾ç‰‡ï¼š</p><ul><li><p>è°·æ­Œå›¾ç‰‡ + imagesize</p></li><li><p>pixabayã€unsplashã€gettyimages+gettyimages downloader</p></li><li><p>gif: è°·æ­Œ best sites for gif</p></li><li><p>icon: è°·æ­Œ xxx inco filetype:pngã€incofont</p></li></ul></li><li><p>pptæ¨¡ç‰ˆ:</p><ul><li>islideæ’ä»¶</li><li>canva</li></ul></li></ul></li><li><p>æ³¨æ„éµå®ˆç‰ˆæƒ,éå•†ç”¨åŸºæœ¬æ²¡æœ‰é£é™©ã€‚</p></li><li><p> å¯ç”¨å„ç§ä¸‹è½½å·¥å…·ä¸‹è½½ç´ æ</p></li><li><p>éœ€æ³¨æ„ç´ æçš„è´¨é‡ã€é£æ ¼ç­‰ç¬¦åˆè¦æ±‚</p></li></ol><h2 id="æœç´¢å·¥å…·è½¯ä»¶"><a href="#æœç´¢å·¥å…·è½¯ä»¶" class="headerlink" title="æœç´¢å·¥å…·è½¯ä»¶"></a>æœç´¢å·¥å…·è½¯ä»¶</h2><p>æ€è€ƒé€»è¾‘ï¼šåœ¨çº¿å·¥å…·-&gt;ä¸‹è½½è½¯ä»¶-&gt;å®‰è£…æ’ä»¶</p><ul><li><p>åœ¨çº¿å·¥å…·ï¼š</p><ul><li><p>åœ¨çº¿æµ·æŠ¥è®¾è®¡ï¼šcanva.com</p></li><li><p>åœ¨çº¿æŠ å›¾ï¼šremove.bg</p></li><li><p>æ–‡å­—æŠ“è¯­éŸ³ï¼šè…¾è®¯æ™ºå½±ã€Azure</p></li><li><p>ç”»è„‘å›¾ã€æ¦‚å¿µå›¾ï¼šmiroã€canva</p></li><li><p>æ‰¾å°è¯ï¼šæ‰¾å°è¯ç½‘</p></li><li><p> åœ¨çº¿å‰ªè¾‘è§†é¢‘ï¼šclicpchampã€flexclip</p></li><li><p>æµ‹ç½‘é€Ÿï¼šfast.com</p></li><li><p>æ£€æµ‹é™Œç”Ÿé“¾æ¥å®‰å…¨æ€§ï¼švirustotal.com</p></li><li><p>è°·æ­Œ xxxéœ€æ±‚+online</p></li></ul></li><li><p>è½¯ä»¶ï¼š</p><ul><li>è°·æ­Œ best apps for xxx</li><li>alternative.net(å¯»æ‰¾æŸä¸ªè½¯ä»¶çš„æ›¿ä»£è½¯ä»¶)</li></ul></li><li><p>æ’ä»¶ï¼š</p><ul><li>Chromeæ’ä»¶ï¼šè°·æ­Œå•†åº—æœä½¿ç”¨çš„è½¯ä»¶çš„æ’ä»¶</li><li>è°·æ­Œ best chrome extension productivity</li><li>è°·æ­Œ best xxx plugin</li></ul></li></ul><h2 id="è¿ç”¨AIå·¥å…·"><a href="#è¿ç”¨AIå·¥å…·" class="headerlink" title="è¿ç”¨AIå·¥å…·"></a>è¿ç”¨AIå·¥å…·</h2><ol><li>ChatGPTç­‰AIå·¥å…·å¯ç›´æ¥å›ç­”é—®é¢˜,æ— éœ€æœç´¢</li><li> å¯è¿›è¡Œè¿½é—®ã€å¯¹æ¯”ã€æ¨ç†ç­‰,åŠŸèƒ½å¼ºå¤§</li><li>ç»“åˆä¼ ç»Ÿæœç´¢æŠ€æœ¯å’ŒAIå·¥å…·,å½¢æˆè¶…çº§æœç´¢æŠ€æœ¯</li><li>AIå°†æ·±åˆ»å½±å“æœç´¢æ–¹å¼,è¦ç§¯æè¿ç”¨</li></ol>]]></content>
    
    
    <categories>
      
      <category>å®ç”¨æŠ€èƒ½</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>YOLOv8è®­ç»ƒè‡ªå·±çš„æ•°æ®é›†</title>
    <link href="/2023/11/12/YOLOV8%E8%AE%AD%E7%BB%83%E8%87%AA%E5%B7%B1%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86/"/>
    <url>/2023/11/12/YOLOV8%E8%AE%AD%E7%BB%83%E8%87%AA%E5%B7%B1%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸‹è½½ä»£ç "><a href="#ä¸‹è½½ä»£ç " class="headerlink" title="ä¸‹è½½ä»£ç "></a>ä¸‹è½½ä»£ç </h2><p>ä¸‹è½½YOLOv8ä»£ç ï¼š<a href="https://github.com/ultralytics/ultralytics">ä»“åº“åœ°å€</a></p><p><code>git@github.com:ultralytics/ultralytics.git</code></p><h2 id="ä¸‹è½½é¢„è®­ç»ƒæƒé‡"><a href="#ä¸‹è½½é¢„è®­ç»ƒæƒé‡" class="headerlink" title="ä¸‹è½½é¢„è®­ç»ƒæƒé‡"></a>ä¸‹è½½é¢„è®­ç»ƒæƒé‡</h2><p><img src="/../images/image-20231112160352849.png" alt="image-20231112160352849"></p><p>åœ¨githubä¸‹è½½å®˜æ–¹æä¾›çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå°†å…¶æ”¾åˆ°ä»£ç æ ¹ç›®å½•</p><h2 id="å‡†å¤‡æ•°æ®é›†"><a href="#å‡†å¤‡æ•°æ®é›†" class="headerlink" title="å‡†å¤‡æ•°æ®é›†"></a>å‡†å¤‡æ•°æ®é›†</h2><p>ä½¿ç”¨[Label Studioåˆ¶ä½œçš„æ•°æ®é›†</p><p><img src="/../images/image-20231112161249790.png" alt="image-20231112161249790"></p><h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><h3 id="ä¿®æ”¹æ•°æ®é›†è·¯å¾„"><a href="#ä¿®æ”¹æ•°æ®é›†è·¯å¾„" class="headerlink" title="ä¿®æ”¹æ•°æ®é›†è·¯å¾„"></a>ä¿®æ”¹æ•°æ®é›†è·¯å¾„</h3><p><img src="/../images/image-20231112161526719.png" alt="image-20231112161526719"></p><p>æ‹·è´coco.yamlï¼Œé‡å‘½åä¸ºsubimg.yamlï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Ultralytics YOLO ğŸš€, AGPL-3.0 license</span><br><span class="hljs-comment"># COCO128 dataset https://www.kaggle.com/ultralytics/coco128 (first 128 images from COCO train2017) by Ultralytics</span><br><span class="hljs-comment"># Example usage: yolo train data=coco128.yaml</span><br><span class="hljs-comment"># parent</span><br><span class="hljs-comment"># â”œâ”€â”€ ultralytics</span><br><span class="hljs-comment"># â””â”€â”€ datasets</span><br><span class="hljs-comment">#     â””â”€â”€ coco128  â† downloads here (7 MB)</span><br><br><br><span class="hljs-comment"># Train/val/test sets as 1) dir: path/to/imgs, 2) file: path/to/imgs.txt, or 3) list: [path/to/imgs1, path/to/imgs2, ..]</span><br><span class="hljs-attr">path:</span> <span class="hljs-string">/Users/yuhong/Desktop/yolov8demo/data/subimg</span>  <span class="hljs-comment"># dataset root dir æ•°æ®é›†ç›®å½•</span><br><span class="hljs-attr">train:</span> <span class="hljs-string">images/train</span>  <span class="hljs-comment"># train images (relative to &#x27;path&#x27;) 128 images è®­ç»ƒé›†ç›®å½•</span><br><span class="hljs-attr">val:</span> <span class="hljs-string">images/train</span>  <span class="hljs-comment"># val images (relative to &#x27;path&#x27;) 128 images éªŒè¯é›†ç›®å½•</span><br><span class="hljs-comment"># test:  # test images (optional)</span><br><br><span class="hljs-comment"># Classes</span><br><span class="hljs-attr">names:</span><br>  <span class="hljs-attr">0:</span> <span class="hljs-string">subimg</span> <span class="hljs-comment"># ç±»åˆ«åç§°ï¼Œè¿™é‡Œåªæœ‰ä¸€ç±»</span><br><br><br><span class="hljs-comment"># Download script/URL (optional)</span><br><span class="hljs-comment"># download: https://ultralytics.com/assets/coco128.zip</span><br><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç±»åˆ«æ•°"><a href="#ä¿®æ”¹ç±»åˆ«æ•°" class="headerlink" title="ä¿®æ”¹ç±»åˆ«æ•°"></a>ä¿®æ”¹ç±»åˆ«æ•°</h3><p><img src="/../images/image-20231112162209950.png" alt="image-20231112162209950"></p><p>æ‹·è´è¿™é‡Œçš„yolov8.yamlï¼Œé‡å‘½åä¸ºmyyolov8.yamlï¼Œåªéœ€è¦ä¿®æ”¹ç±»åˆ«æ•°ã€‚æ–‡ä»¶å†…å®¹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Ultralytics YOLO ğŸš€, AGPL-3.0 license</span><br><span class="hljs-comment"># YOLOv8 object detection model with P3-P5 outputs. For Usage examples see https://docs.ultralytics.com/tasks/detect</span><br><br><span class="hljs-comment"># Parameters</span><br><span class="hljs-attr">nc:</span> <span class="hljs-number">1</span>  <span class="hljs-comment"># number of classes åªéœ€è¦ä¿®æ”¹è¿™é‡Œ</span><br><span class="hljs-attr">scales:</span> <span class="hljs-comment"># model compound scaling constants, i.e. &#x27;model=yolov8n.yaml&#x27; will call yolov8.yaml with scale &#x27;n&#x27;</span><br>  <span class="hljs-comment"># [depth, width, max_channels]</span><br>  <span class="hljs-attr">n:</span> [<span class="hljs-number">0.33</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">1024</span>]  <span class="hljs-comment"># YOLOv8n summary: 225 layers,  3157200 parameters,  3157184 gradients,   8.9 GFLOPs</span><br>  <span class="hljs-attr">s:</span> [<span class="hljs-number">0.33</span>, <span class="hljs-number">0.50</span>, <span class="hljs-number">1024</span>]  <span class="hljs-comment"># YOLOv8s summary: 225 layers, 11166560 parameters, 11166544 gradients,  28.8 GFLOPs</span><br>  <span class="hljs-attr">m:</span> [<span class="hljs-number">0.67</span>, <span class="hljs-number">0.75</span>, <span class="hljs-number">768</span>]   <span class="hljs-comment"># YOLOv8m summary: 295 layers, 25902640 parameters, 25902624 gradients,  79.3 GFLOPs</span><br>  <span class="hljs-attr">l:</span> [<span class="hljs-number">1.00</span>, <span class="hljs-number">1.00</span>, <span class="hljs-number">512</span>]   <span class="hljs-comment"># YOLOv8l summary: 365 layers, 43691520 parameters, 43691504 gradients, 165.7 GFLOPs</span><br>  <span class="hljs-attr">x:</span> [<span class="hljs-number">1.00</span>, <span class="hljs-number">1.25</span>, <span class="hljs-number">512</span>]   <span class="hljs-comment"># YOLOv8x summary: 365 layers, 68229648 parameters, 68229632 gradients, 258.5 GFLOPs</span><br><br><span class="hljs-comment"># YOLOv8.0n backbone</span><br><span class="hljs-attr">backbone:</span><br>  <span class="hljs-comment"># [from, repeats, module, args]</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">64</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  <span class="hljs-comment"># 0-P1/2</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">128</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  <span class="hljs-comment"># 1-P2/4</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C2f</span>, [<span class="hljs-number">128</span>, <span class="hljs-literal">True</span>]]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  <span class="hljs-comment"># 3-P3/8</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">6</span>, <span class="hljs-string">C2f</span>, [<span class="hljs-number">256</span>, <span class="hljs-literal">True</span>]]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  <span class="hljs-comment"># 5-P4/16</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">6</span>, <span class="hljs-string">C2f</span>, [<span class="hljs-number">512</span>, <span class="hljs-literal">True</span>]]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">1024</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  <span class="hljs-comment"># 7-P5/32</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C2f</span>, [<span class="hljs-number">1024</span>, <span class="hljs-literal">True</span>]]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">SPPF</span>, [<span class="hljs-number">1024</span>, <span class="hljs-number">5</span>]]  <span class="hljs-comment"># 9</span><br><br><span class="hljs-comment"># YOLOv8.0n head</span><br><span class="hljs-attr">head:</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">nn.Upsample</span>, [<span class="hljs-string">None</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;nearest&#x27;</span>]]<br>  <span class="hljs-bullet">-</span> [[<span class="hljs-number">-1</span>, <span class="hljs-number">6</span>], <span class="hljs-number">1</span>, <span class="hljs-string">Concat</span>, [<span class="hljs-number">1</span>]]  <span class="hljs-comment"># cat backbone P4</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C2f</span>, [<span class="hljs-number">512</span>]]  <span class="hljs-comment"># 12</span><br><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">nn.Upsample</span>, [<span class="hljs-string">None</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;nearest&#x27;</span>]]<br>  <span class="hljs-bullet">-</span> [[<span class="hljs-number">-1</span>, <span class="hljs-number">4</span>], <span class="hljs-number">1</span>, <span class="hljs-string">Concat</span>, [<span class="hljs-number">1</span>]]  <span class="hljs-comment"># cat backbone P3</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C2f</span>, [<span class="hljs-number">256</span>]]  <span class="hljs-comment"># 15 (P3/8-small)</span><br><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]<br>  <span class="hljs-bullet">-</span> [[<span class="hljs-number">-1</span>, <span class="hljs-number">12</span>], <span class="hljs-number">1</span>, <span class="hljs-string">Concat</span>, [<span class="hljs-number">1</span>]]  <span class="hljs-comment"># cat head P4</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C2f</span>, [<span class="hljs-number">512</span>]]  <span class="hljs-comment"># 18 (P4/16-medium)</span><br><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]<br>  <span class="hljs-bullet">-</span> [[<span class="hljs-number">-1</span>, <span class="hljs-number">9</span>], <span class="hljs-number">1</span>, <span class="hljs-string">Concat</span>, [<span class="hljs-number">1</span>]]  <span class="hljs-comment"># cat head P5</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C2f</span>, [<span class="hljs-number">1024</span>]]  <span class="hljs-comment"># 21 (P5/32-large)</span><br><br>  <span class="hljs-bullet">-</span> [[<span class="hljs-number">15</span>, <span class="hljs-number">18</span>, <span class="hljs-number">21</span>], <span class="hljs-number">1</span>, <span class="hljs-string">Detect</span>, [<span class="hljs-string">nc</span>]]  <span class="hljs-comment"># Detect(P3, P4, P5)</span><br><br></code></pre></td></tr></table></figure><h2 id="è®­ç»ƒæ•°æ®"><a href="#è®­ç»ƒæ•°æ®" class="headerlink" title="è®­ç»ƒæ•°æ®"></a>è®­ç»ƒæ•°æ®</h2><p>æ ¹ç›®å½•ä¸‹åˆ›å»ºmytrain.py</p><p>æ¨¡å‹å’Œæ•°æ®é›†è·¯å¾„æ¢æˆè‡ªå·±çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> ultralytics <span class="hljs-keyword">import</span> YOLO<br><br><span class="hljs-comment"># Load a model</span><br>model = YOLO(<span class="hljs-string">&quot;/Users/yuhong/Desktop/yolov8demo/ultralytics/cfg/models/v8/myyolov8.yaml&quot;</span>)  <span class="hljs-comment"># build a new model from scratch</span><br>model = YOLO(<span class="hljs-string">&quot;/Users/yuhong/Desktop/yolov8demo/yolov8n.pt&quot;</span>)  <span class="hljs-comment"># load a pretrained model (recommended for training)</span><br><br><span class="hljs-comment"># Use the model</span><br>model.train(data=<span class="hljs-string">&quot;/Users/yuhong/Desktop/yolov8demo/ultralytics/cfg/datasets/subimg.yaml&quot;</span>, epochs=<span class="hljs-number">30</span>)  <span class="hljs-comment"># train the model</span><br>metrics = model.val()  <span class="hljs-comment"># evaluate model performance on the validation set</span><br><span class="hljs-comment"># results = model(&quot;https://ultralytics.com/images/bus.jpg&quot;)  # predict on an image</span><br><span class="hljs-comment"># path = model.export(format=&quot;onnx&quot;)  # export the model to ONNX format</span><br></code></pre></td></tr></table></figure><h2 id="é¢„æµ‹æ•°æ®"><a href="#é¢„æµ‹æ•°æ®" class="headerlink" title="é¢„æµ‹æ•°æ®"></a>é¢„æµ‹æ•°æ®</h2><p>æ ¹ç›®å½•ä¸‹åˆ›å»ºmypredict.py</p><p>æ¨¡å‹è·¯å¾„æ›¿æ¢æˆè®­ç»ƒç”Ÿæˆæ¨¡å‹è·¯å¾„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> ultralytics <span class="hljs-keyword">import</span> YOLO<br><br>model = YOLO(<span class="hljs-string">&quot;/Users/yuhong/Desktop/yolov8demo/runs/detect/train/weights/best.pt&quot;</span>)<br>results = model.predict(source=<span class="hljs-string">&quot;/Users/yuhong/Desktop/yolov8demo/imgs&quot;</span>, save=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><h2 id="å¯¼å‡ºæ¨¡å‹"><a href="#å¯¼å‡ºæ¨¡å‹" class="headerlink" title="å¯¼å‡ºæ¨¡å‹"></a>å¯¼å‡ºæ¨¡å‹</h2><p>è¿™é‡Œå¯¼å‡ºonnxæ¨¡å‹</p><p>æ¨¡å‹è·¯å¾„æ›¿æ¢æˆè®­ç»ƒç”Ÿæˆæ¨¡å‹è·¯å¾„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> ultralytics <span class="hljs-keyword">import</span> YOLO<br><br>model = YOLO(<span class="hljs-string">&#x27;/Users/yuhong/Desktop/yolov8demo/runs/detect/train/weights/best.pt&#x27;</span>)<br>model.export(<span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;onnx&#x27;</span>, dynamic=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Kotlinåç¨‹</title>
    <link href="/2023/11/12/Kotlin%E5%8D%8F%E7%A8%8B/"/>
    <url>/2023/11/12/Kotlin%E5%8D%8F%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p><a href="https://juejin.cn/post/6844903949686800392">ã€ç ä¸Šå¼€å­¦ã€‘Kotlin çš„åç¨‹ç”¨åŠ›ç¥ä¸€çœ¼</a> <a href="https://www.bilibili.com/video/BV164411C7FK/?spm_id_from=888.80997.embed_other.whitelist&t=8&vd_source=32fde9bfd93393aae9adb095d284869c">è§†é¢‘é“¾æ¥</a></p><p><a href="https://juejin.cn/post/6844903968699580430">ã€ç ä¸Šå¼€å­¦ã€‘Kotlin åç¨‹çš„æŒ‚èµ·å¥½ç¥å¥‡å¥½éš¾æ‡‚ï¼Ÿä»Šå¤©æˆ‘æŠŠå®ƒçš„çš®ç»™æ‰’äº†</a> <a href="https://www.bilibili.com/video/BV1KJ41137E9/?spm_id_from=888.80997.embed_other.whitelist&t=8&vd_source=32fde9bfd93393aae9adb095d284869c">è§†é¢‘é“¾æ¥</a></p><p><a href="https://juejin.cn/post/6844904001238990862">ã€ç ä¸Šå¼€å­¦ã€‘åˆ°åº•ä»€ä¹ˆæ˜¯ã€Œéé˜»å¡å¼ã€æŒ‚èµ·ï¼Ÿåç¨‹çœŸçš„æ›´è½»é‡çº§å—ï¼Ÿ</a> <a href="https://www.bilibili.com/video/BV1JE411R7hp/?spm_id_from=888.80997.embed_other.whitelist&t=7&vd_source=32fde9bfd93393aae9adb095d284869c">è§†é¢‘é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>Kotlin</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Qtå­¦ä¹ -å¯é‡å…¥å’Œçº¿ç¨‹å®‰å…¨</title>
    <link href="/2023/11/12/Qt%E5%AD%A6%E4%B9%A0-%E5%8F%AF%E9%87%8D%E5%85%A5%E5%92%8C%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/"/>
    <url>/2023/11/12/Qt%E5%AD%A6%E4%B9%A0-%E5%8F%AF%E9%87%8D%E5%85%A5%E5%92%8C%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/</url>
    
    <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€ <a href="https://doc.qt.io/qt-6/threads-reentrancy.html">https://doc.qt.io/qt-6/threads-reentrancy.html</a></p><ul><li><p>ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å‡½æ•°å¯ä»¥ä»å¤šä¸ªçº¿ç¨‹è¢«åŒæ—¶è°ƒç”¨ï¼Œå³ä½¿è°ƒç”¨ä½¿ç”¨å…±äº«æ•°æ®ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºå¯¹å…±äº«æ•°æ®çš„æ‰€æœ‰å¼•ç”¨éƒ½æ˜¯åºåˆ—åŒ–çš„ã€‚</p></li><li><p>å¯é‡å…¥å‡½æ•°ä¹Ÿå¯ä»¥ä»å¤šä¸ªçº¿ç¨‹è¢«åŒæ—¶è°ƒç”¨ï¼Œä½†å‰ææ˜¯æ¯æ¬¡è°ƒç”¨éƒ½ä½¿ç”¨è‡ªå·±çš„æ•°æ®ã€‚</p></li></ul><p>å› æ­¤ï¼Œçº¿ç¨‹å®‰å…¨å‡½æ•°æ€»æ˜¯å¯é‡å…¥çš„ï¼Œä½†å¯é‡å…¥å‡½æ•°å¹¶ä¸æ€»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>é€šè¿‡æ‰©å±•ï¼Œ<strong>å¦‚æœä¸€ä¸ªç±»çš„æˆå‘˜å‡½æ•°å¯ä»¥ä»å¤šä¸ªçº¿ç¨‹å®‰å…¨åœ°è°ƒç”¨ï¼Œåˆ™è¯¥ç±»è¢«ç§°ä¸ºå¯é‡å…¥çš„ï¼Œåªè¦æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨è¯¥ç±»çš„ä¸åŒå®ä¾‹ã€‚ å¦‚æœå¯ä»¥ä»å¤šä¸ªçº¿ç¨‹å®‰å…¨åœ°è°ƒç”¨è¯¥ç±»çš„æˆå‘˜å‡½æ•°ï¼Œåˆ™è¯¥ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå³ä½¿æ‰€æœ‰çº¿ç¨‹éƒ½ä½¿ç”¨è¯¥ç±»çš„åŒä¸€ä¸ªå®ä¾‹</strong>ã€‚</p><p>æ³¨æ„ï¼šå¦‚æœ Qt ç±»æ‰“ç®—ç”±å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œåˆ™å®ƒä»¬ä»…è¢«è®°å½•ä¸ºçº¿ç¨‹å®‰å…¨çš„ã€‚ å¦‚æœå‡½æ•°æœªæ ‡è®°ä¸ºçº¿ç¨‹å®‰å…¨æˆ–å¯é‡å…¥ï¼Œåˆ™ä¸åº”åœ¨ä¸åŒçº¿ç¨‹ä¸­ä½¿ç”¨å®ƒã€‚ å¦‚æœæŸä¸ªç±»æœªæ ‡è®°ä¸ºçº¿ç¨‹å®‰å…¨æˆ–å¯é‡å…¥ï¼Œåˆ™ä¸åº”ä»ä¸åŒçº¿ç¨‹è®¿é—®è¯¥ç±»çš„ç‰¹å®šå®ä¾‹ã€‚</p><h2 id="å¯é‡å…¥"><a href="#å¯é‡å…¥" class="headerlink" title="å¯é‡å…¥"></a>å¯é‡å…¥</h2><p>C++ ç±»é€šå¸¸æ˜¯å¯é‡å…¥çš„ï¼Œä»…ä»…æ˜¯å› ä¸ºå®ƒä»¬åªè®¿é—®å®ƒä»¬è‡ªå·±çš„æˆå‘˜æ•°æ®ã€‚ ä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥åœ¨å¯é‡å…¥ç±»çš„å®ä¾‹ä¸Šè°ƒç”¨æˆå‘˜å‡½æ•°ï¼Œåªè¦æ²¡æœ‰å…¶ä»–çº¿ç¨‹å¯ä»¥åŒæ—¶åœ¨è¯¥ç±»çš„åŒä¸€å®ä¾‹ä¸Šè°ƒç”¨æˆå‘˜å‡½æ•°ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢çš„ Counter ç±»æ˜¯å¯é‡å…¥çš„ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Counter</span>() &#123; n = <span class="hljs-number">0</span>; &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> </span>&#123; ++n; &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">decrement</span><span class="hljs-params">()</span> </span>&#123; --n; &#125;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">value</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> n; &#125;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> n;<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¯¥ç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå¦‚æœå¤šä¸ªçº¿ç¨‹è¯•å›¾ä¿®æ”¹æ•°æ®æˆå‘˜ nï¼Œç»“æœæ˜¯æœªå®šä¹‰çš„ã€‚è¿™æ˜¯å› ä¸º ++ å’Œ â€“ è¿ç®—ç¬¦å¹¶ä¸æ€»æ˜¯åŸå­çš„ã€‚å®é™…ä¸Šï¼Œå®ƒä»¬é€šå¸¸æ‰©å±•ä¸ºä¸‰ä¸ªæœºå™¨æŒ‡ä»¤ï¼š</p><ol><li>å°†å˜é‡çš„å€¼åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ã€‚</li><li>å¢åŠ æˆ–å‡å°‘å¯„å­˜å™¨çš„å€¼ã€‚</li><li>å°†å¯„å­˜å™¨çš„å€¼å­˜å›ä¸»å­˜ã€‚</li></ol><p>å¦‚æœçº¿ç¨‹ A å’Œçº¿ç¨‹ B åŒæ—¶åŠ è½½å˜é‡çš„æ—§å€¼ï¼Œé€’å¢å®ƒä»¬çš„å¯„å­˜å™¨ï¼Œç„¶åå°†å…¶å­˜å‚¨å›å»ï¼Œå®ƒä»¬æœ€ç»ˆä¼šç›¸äº’è¦†ç›–ï¼Œå¹¶ä¸”å˜é‡åªä¼šé€’å¢ä¸€æ¬¡ï¼</p><h2 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h2><p>æ˜¾ç„¶ï¼Œè®¿é—®å¿…é¡»ä¸²è¡ŒåŒ–ï¼šçº¿ç¨‹ A å¿…é¡»åœ¨çº¿ç¨‹ B æ‰§è¡Œç›¸åŒæ­¥éª¤ä¹‹å‰ä¸é—´æ–­åœ°ï¼ˆåŸå­åœ°ï¼‰æ‰§è¡Œæ­¥éª¤ 1ã€2ã€3ï¼› æˆ–ç›¸åäº¦ç„¶ã€‚ ä½¿ç±»çº¿ç¨‹å®‰å…¨çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ QMutex ä¿æŠ¤å¯¹æ•°æ®æˆå‘˜çš„æ‰€æœ‰è®¿é—®ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Counter</span>() &#123; n = <span class="hljs-number">0</span>; &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;mutex)</span></span>; ++n; &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">decrement</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;mutex)</span></span>; --n; &#125;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">value</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;mutex)</span></span>; <span class="hljs-keyword">return</span> n; &#125;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">mutable</span> QMutex mutex;<br>    <span class="hljs-type">int</span> n;<br>&#125;;<br></code></pre></td></tr></table></figure><p>QMutexLocker ç±»åœ¨å…¶æ„é€ å‡½æ•°ä¸­è‡ªåŠ¨é”å®šäº’æ–¥é”ï¼Œå¹¶åœ¨å‡½æ•°ç»“æŸæ—¶è°ƒç”¨ææ„å‡½æ•°æ—¶å°†å…¶è§£é”ã€‚ é”å®šäº’æ–¥é‡å¯ç¡®ä¿æ¥è‡ªä¸åŒçº¿ç¨‹çš„è®¿é—®å°†è¢«åºåˆ—åŒ–ã€‚ mutex æ•°æ®æˆå‘˜æ˜¯ç”¨ mutable é™å®šç¬¦å£°æ˜çš„ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨ value() ä¸­é”å®šå’Œè§£é” mutexï¼Œè¿™æ˜¯ä¸€ä¸ª const å‡½æ•°ã€‚</p><h2 id="Qt-ç±»æ³¨é‡Š"><a href="#Qt-ç±»æ³¨é‡Š" class="headerlink" title="Qt ç±»æ³¨é‡Š"></a>Qt ç±»æ³¨é‡Š</h2><p>è®¸å¤š Qt ç±»æ˜¯å¯é‡å…¥çš„ï¼Œä½†å®ƒä»¬ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºä½¿å®ƒä»¬çº¿ç¨‹å®‰å…¨ä¼šå¯¼è‡´é‡å¤é”å®šå’Œè§£é” QMutex çš„é¢å¤–å¼€é”€ã€‚ ä¾‹å¦‚ï¼ŒQString æ˜¯å¯é‡å…¥çš„ä½†ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ æ‚¨å¯ä»¥åŒæ—¶ä»å¤šä¸ªçº¿ç¨‹å®‰å…¨åœ°è®¿é—® QString çš„ä¸åŒå®ä¾‹ï¼Œä½†æ˜¯æ‚¨ä¸èƒ½åŒæ—¶ä»å¤šä¸ªçº¿ç¨‹å®‰å…¨åœ°è®¿é—® QString çš„åŒä¸€ä¸ªå®ä¾‹ï¼ˆé™¤éæ‚¨è‡ªå·±ä½¿ç”¨ QMutex ä¿æŠ¤è®¿é—®ï¼‰ã€‚</p><p>ä¸€äº› Qt ç±»å’Œå‡½æ•°æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¿™äº›ä¸»è¦æ˜¯ä¸çº¿ç¨‹ç›¸å…³çš„ç±»ï¼ˆä¾‹å¦‚ QMutexï¼‰å’ŒåŸºæœ¬å‡½æ•°ï¼ˆä¾‹å¦‚ QCoreApplication::postEvent()ï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Qtå­¦ä¹ -çº¿ç¨‹å’ŒQObjects</title>
    <link href="/2023/11/12/Qt%E5%AD%A6%E4%B9%A0-%E7%BA%BF%E7%A8%8B%E5%92%8CQObjects/"/>
    <url>/2023/11/12/Qt%E5%AD%A6%E4%B9%A0-%E7%BA%BF%E7%A8%8B%E5%92%8CQObjects/</url>
    
    <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€ <a href="https://doc.qt.io/qt-6/threads-qobject.html">https://doc.qt.io/qt-6/threads-qobject.html</a></p><p>QThread ç»§æ‰¿äº†QObjectã€‚å®ƒå‘å‡ºä¿¡å·ä»¥æŒ‡ç¤ºçº¿ç¨‹å¼€å§‹æˆ–å®Œæˆæ‰§è¡Œï¼Œå¹¶æä¾›ä¸€äº›æ§½å‡½æ•°ã€‚</p><p>æ›´æœ‰è¶£çš„æ˜¯ï¼ŒQObjects å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨ï¼Œå‘å‡ºè°ƒç”¨å…¶ä»–çº¿ç¨‹ä¸­çš„æ§½çš„ä¿¡å·ï¼Œå¹¶å°†äº‹ä»¶å‘å¸ƒåˆ°â€œå­˜åœ¨â€åœ¨å…¶ä»–çº¿ç¨‹ä¸­çš„å¯¹è±¡ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºå…è®¸æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„äº‹ä»¶å¾ªç¯ã€‚</p><h2 id="QObject-é‡å…¥"><a href="#QObject-é‡å…¥" class="headerlink" title="QObject é‡å…¥"></a>QObject é‡å…¥</h2><p>QObject æ˜¯å¯é‡å…¥çš„ã€‚ å®ƒçš„å¤§å¤šæ•°é GUI å­ç±»ï¼Œä¾‹å¦‚ QTimerã€QTcpSocketã€QUdpSocket å’Œ QProcessï¼Œä¹Ÿæ˜¯å¯é‡å…¥çš„ï¼Œä»è€Œå¯ä»¥ä»å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨è¿™äº›ç±»ã€‚ è¯·æ³¨æ„ï¼Œè¿™äº›ç±»è¢«è®¾è®¡ä¸ºåœ¨å•ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºå’Œä½¿ç”¨ï¼› ä¸èƒ½ä¿è¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶ä»å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å®ƒçš„å‡½æ•°ã€‚ éœ€è¦æ³¨æ„ä¸‰ä¸ªçº¦æŸï¼š</p><ul><li>QObject çš„å­å¯¹è±¡å¿…é¡»å§‹ç»ˆåœ¨åˆ›å»ºçˆ¶å¯¹è±¡çš„çº¿ç¨‹ä¸­åˆ›å»ºã€‚ è¿™æ„å‘³ç€ï¼Œé™¤å…¶ä»–äº‹é¡¹å¤–ï¼Œæ‚¨æ°¸è¿œä¸åº”å°† QThread å¯¹è±¡ (this) ä½œä¸ºåœ¨çº¿ç¨‹ä¸­åˆ›å»ºçš„å¯¹è±¡çš„çˆ¶å¯¹è±¡ä¼ é€’ï¼ˆå› ä¸º QThread å¯¹è±¡æœ¬èº«æ˜¯åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºçš„ï¼‰ã€‚</li><li>äº‹ä»¶é©±åŠ¨å¯¹è±¡åªèƒ½åœ¨å•ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™é€‚ç”¨äºå®šæ—¶å™¨æœºåˆ¶å’Œç½‘ç»œæ¨¡å—ã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¸èƒ½åœ¨ä¸æ˜¯å¯¹è±¡çº¿ç¨‹çš„çº¿ç¨‹ä¸­å¯åŠ¨è®¡æ—¶å™¨æˆ–è¿æ¥å¥—æ¥å­—ã€‚</li><li>æ‚¨å¿…é¡»ç¡®ä¿åœ¨åˆ é™¤ QThread ä¹‹å‰åˆ é™¤çº¿ç¨‹ä¸­åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ run() å®ç°ä¸­åœ¨å †æ ˆä¸Šåˆ›å»ºå¯¹è±¡æ¥è½»æ¾å®Œæˆã€‚</li></ul><p>å°½ç®¡ QObject æ˜¯å¯é‡å…¥çš„ï¼Œä½† GUI ç±»ï¼Œå°¤å…¶æ˜¯ QWidget åŠå…¶æ‰€æœ‰å­ç±»ï¼Œéƒ½ä¸æ˜¯å¯é‡å…¥çš„ã€‚å®ƒä»¬åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨ã€‚å¦‚å‰æ‰€è¿°ï¼Œè¿˜å¿…é¡»ä»è¯¥çº¿ç¨‹è°ƒç”¨ QCoreApplication::exec()ã€‚</p><p>å®é™…ä¸Šï¼Œé€šè¿‡å°†è€—æ—¶çš„æ“ä½œæ”¾åœ¨å•ç‹¬çš„å·¥ä½œçº¿ç¨‹ä¸­å¹¶åœ¨å·¥ä½œçº¿ç¨‹å®Œæˆæ—¶åœ¨ä¸»çº¿ç¨‹çš„å±å¹•ä¸Šæ˜¾ç¤ºç»“æœï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°è§£å†³æ— æ³•åœ¨ä¸»çº¿ç¨‹ä»¥å¤–çš„å…¶ä»–çº¿ç¨‹ä¸­ä½¿ç”¨ GUI ç±»çš„é—®é¢˜ã€‚ </p><p>é€šå¸¸ï¼Œä¸æ”¯æŒåœ¨ QApplication ä¹‹å‰åˆ›å»º QObjectsï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é€€å‡ºæ—¶å‘ç”Ÿå¥‡æ€ªçš„å´©æºƒï¼Œå…·ä½“å–å†³äºå¹³å°ã€‚ è¿™æ„å‘³ç€ä¹Ÿä¸æ”¯æŒ QObject çš„é™æ€å®ä¾‹ã€‚ ä¸€ä¸ªç»“æ„åˆç†çš„å•çº¿ç¨‹æˆ–å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºåº”è¯¥ä½¿ QApplication æœ€å…ˆåˆ›å»ºï¼Œæœ€åé”€æ¯ QObjectã€‚</p><h2 id="çº¿ç¨‹äº‹ä»¶å¾ªç¯"><a href="#çº¿ç¨‹äº‹ä»¶å¾ªç¯" class="headerlink" title="çº¿ç¨‹äº‹ä»¶å¾ªç¯"></a>çº¿ç¨‹äº‹ä»¶å¾ªç¯</h2><p>æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥æœ‰è‡ªå·±çš„äº‹ä»¶å¾ªç¯ã€‚ åˆå§‹çº¿ç¨‹ä½¿ç”¨ QCoreApplication::exec() å¯åŠ¨å…¶äº‹ä»¶å¾ªç¯ï¼Œæˆ–è€…å¯¹äºå•å¯¹è¯æ¡† GUI åº”ç”¨ç¨‹åºï¼Œæœ‰æ—¶ä½¿ç”¨ QDialog::exec()ã€‚ å…¶ä»–çº¿ç¨‹å¯ä»¥ä½¿ç”¨ QThread::exec() å¯åŠ¨äº‹ä»¶å¾ªç¯ã€‚ ä¸ QCoreApplication ä¸€æ ·ï¼ŒQThread æä¾›äº†ä¸€ä¸ª exit(int) å‡½æ•°å’Œä¸€ä¸ª quit() æ§½ã€‚</p><p>çº¿ç¨‹ä¸­çš„äº‹ä»¶å¾ªç¯ä½¿çº¿ç¨‹å¯ä»¥ä½¿ç”¨æŸäº›éœ€è¦äº‹ä»¶å¾ªç¯çš„é GUI Qt ç±»ï¼ˆä¾‹å¦‚ QTimerã€QTcpSocket å’Œ QProcessï¼‰ã€‚ å®ƒè¿˜å¯ä»¥å°†æ¥è‡ªä»»ä½•çº¿ç¨‹çš„ä¿¡å·è¿æ¥åˆ°ç‰¹å®šçº¿ç¨‹çš„æ§½ã€‚ è¿™åœ¨ä¸‹é¢çš„è·¨çº¿ç¨‹ä¿¡å·å’Œæ§½éƒ¨åˆ†ä¸­æœ‰æ›´è¯¦ç»†çš„è§£é‡Šã€‚</p><p><img src="https://doc.qt.io/qt-6/images/threadsandobjects.png" alt="Threads, objects, and event loops"></p><p>QObject å®ä¾‹å­˜åœ¨äºåˆ›å»ºå®ƒçš„çº¿ç¨‹ä¸­ã€‚è¯¥å¯¹è±¡çš„äº‹ä»¶ç”±è¯¥çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯åˆ†æ´¾ã€‚ä½¿ç”¨ QObject::thread() å¯ä»¥è·å¾— QObject æ‰€åœ¨çš„çº¿ç¨‹ã€‚</p><p>QObject::moveToThread() å‡½æ•°æ›´æ”¹å¯¹è±¡åŠå…¶å­å¯¹è±¡çš„çº¿ç¨‹äº²å’Œæ€§ï¼ˆå¦‚æœå¯¹è±¡æœ‰çˆ¶å¯¹è±¡ï¼Œåˆ™ä¸èƒ½ç§»åŠ¨è¯¥å¯¹è±¡ï¼‰ã€‚</p><p>ä»æ‹¥æœ‰è¯¥å¯¹è±¡çš„çº¿ç¨‹ï¼ˆæˆ–ä»¥å…¶ä»–æ–¹å¼è®¿é—®è¯¥å¯¹è±¡ï¼‰ä»¥å¤–çš„çº¿ç¨‹è°ƒç”¨ QObject ä¸Šçš„ delete æ˜¯ä¸å®‰å…¨çš„ï¼Œé™¤éæ‚¨ä¿è¯è¯¥å¯¹è±¡å½“æ—¶ä¸åœ¨å¤„ç†äº‹ä»¶ã€‚ æ”¹ç”¨ QObject::deleteLater() ï¼Œå°†å‘å¸ƒä¸€ä¸ª DeferredDelete äº‹ä»¶ï¼Œå¯¹è±¡çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯æœ€ç»ˆå°†æ‹¾å–è¯¥äº‹ä»¶ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‹¥æœ‰ QObject çš„çº¿ç¨‹æ˜¯åˆ›å»º QObject çš„çº¿ç¨‹ï¼Œä½†ä¸æ˜¯åœ¨è°ƒç”¨ QObject::moveToThread() ä¹‹åã€‚</p><p>å¦‚æœæ²¡æœ‰äº‹ä»¶å¾ªç¯åœ¨è¿è¡Œï¼Œäº‹ä»¶å°†ä¸ä¼šä¼ é€’ç»™å¯¹è±¡ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨çº¿ç¨‹ä¸­åˆ›å»ºäº†ä¸€ä¸ª QTimer å¯¹è±¡ä½†ä»æœªè°ƒç”¨ exec()ï¼Œåˆ™ QTimer å°†æ°¸è¿œä¸ä¼šå‘å‡ºå…¶ timeout() ä¿¡å·ã€‚ è°ƒç”¨ deleteLater() ä¹Ÿä¸èµ·ä½œç”¨ã€‚ ï¼ˆè¿™äº›é™åˆ¶ä¹Ÿé€‚ç”¨äºä¸»çº¿ç¨‹ã€‚ï¼‰</p><p>æ‚¨å¯ä»¥éšæ—¶ä½¿ç”¨çº¿ç¨‹å®‰å…¨å‡½æ•° QCoreApplication::postEvent() æ‰‹åŠ¨å°†äº‹ä»¶å‘å¸ƒåˆ°ä»»ä½•çº¿ç¨‹ä¸­çš„ä»»ä½•å¯¹è±¡ã€‚äº‹ä»¶å°†ç”±åˆ›å»ºå¯¹è±¡çš„çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯è‡ªåŠ¨åˆ†æ´¾ã€‚</p><p>æ‰€æœ‰çº¿ç¨‹éƒ½æ”¯æŒäº‹ä»¶è¿‡æ»¤å™¨ï¼Œä½†é™åˆ¶æ˜¯ç›‘è§†å¯¹è±¡å¿…é¡»ä¸ç›‘è§†å¯¹è±¡ä½äºåŒä¸€çº¿ç¨‹ä¸­ã€‚ ç±»ä¼¼åœ°ï¼ŒQCoreApplication::sendEvent()ï¼ˆä¸ postEvent() ä¸åŒï¼‰åªèƒ½ç”¨äºå°†äº‹ä»¶åˆ†æ´¾ç»™ä½äºè°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹ä¸­çš„å¯¹è±¡ã€‚</p><h2 id="ä»å…¶ä»–çº¿ç¨‹è®¿é—®-QObject-å­ç±»"><a href="#ä»å…¶ä»–çº¿ç¨‹è®¿é—®-QObject-å­ç±»" class="headerlink" title="ä»å…¶ä»–çº¿ç¨‹è®¿é—® QObject å­ç±»"></a>ä»å…¶ä»–çº¿ç¨‹è®¿é—® QObject å­ç±»</h2><p>QObject åŠå…¶æ‰€æœ‰å­ç±»éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ è¿™åŒ…æ‹¬æ•´ä¸ªäº‹ä»¶ä¼ é€’ç³»ç»Ÿã€‚ é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œå½“æ‚¨ä»å¦ä¸€ä¸ªçº¿ç¨‹è®¿é—®å¯¹è±¡æ—¶ï¼Œäº‹ä»¶å¾ªç¯å¯èƒ½ä¼šå°†äº‹ä»¶ä¼ é€’ç»™æ‚¨çš„ QObject å­ç±»ã€‚</p><p>å¦‚æœæ‚¨åœ¨ä¸åœ¨å½“å‰çº¿ç¨‹ä¸­çš„ QObject å­ç±»ä¸Šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡å¯èƒ½ä¼šæ¥æ”¶äº‹ä»¶ï¼Œåˆ™å¿…é¡»ä½¿ç”¨äº’æ–¥é”æ¥ä¿æŠ¤å¯¹ QObject å­ç±»å†…éƒ¨æ•°æ®çš„æ‰€æœ‰è®¿é—®ï¼› å¦åˆ™ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°å´©æºƒæˆ–å…¶ä»–ä¸è‰¯è¡Œä¸ºã€‚</p><p>ä¸å…¶ä»–å¯¹è±¡ä¸€æ ·ï¼ŒQThread å¯¹è±¡å­˜åœ¨äºåˆ›å»ºå¯¹è±¡çš„çº¿ç¨‹ä¸­â€”â€”è€Œä¸æ˜¯å­˜åœ¨äºè°ƒç”¨ QThread::run() æ—¶åˆ›å»ºçš„çº¿ç¨‹ä¸­ã€‚ åœ¨ QThread å­ç±»ä¸­æä¾›æ§½å‡½æ•°é€šå¸¸æ˜¯ä¸å®‰å…¨çš„ï¼Œé™¤éæ‚¨ä½¿ç”¨äº’æ–¥ä½“ä¿æŠ¤æˆå‘˜å˜é‡ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œæ‚¨å¯ä»¥ä» QThread::run() å®ç°ä¸­å®‰å…¨åœ°å‘å°„ä¿¡å·ï¼Œå› ä¸ºä¿¡å·å‘å°„æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h2 id="è·¨çº¿ç¨‹çš„ä¿¡å·å’Œæ§½"><a href="#è·¨çº¿ç¨‹çš„ä¿¡å·å’Œæ§½" class="headerlink" title="è·¨çº¿ç¨‹çš„ä¿¡å·å’Œæ§½"></a>è·¨çº¿ç¨‹çš„ä¿¡å·å’Œæ§½</h2><p>Qt æ”¯æŒè¿™äº›ä¿¡å·æ§½è¿æ¥ç±»å‹ï¼š</p><ul><li><a href="https://doc.qt.io/qt-6/qt.html#ConnectionType-enum">Auto Connection</a> è‡ªåŠ¨è¿æ¥ï¼ˆé»˜è®¤ï¼‰ï¼Œå¦‚æœä¿¡å·åœ¨æ¥æ”¶å¯¹è±¡å…·æœ‰äº²å’ŒåŠ›çš„çº¿ç¨‹ä¸­å‘å‡ºï¼Œåˆ™è¡Œä¸ºä¸ç›´æ¥è¿æ¥ç›¸åŒã€‚å¦åˆ™ï¼Œè¡Œä¸ºä¸æ’é˜Ÿè¿æ¥ç›¸åŒã€‚â€</li><li><a href="https://doc.qt.io/qt-6/qt.html#ConnectionType-enum">Direct Connection</a> ç›´æ¥è¿æ¥ï¼Œå½“ä¿¡å·å‘å‡ºæ—¶ï¼Œæ§½å‡½æ•°ä¼šç«‹å³è¢«è°ƒç”¨ã€‚æ§½å‡½æ•°åœ¨ä¿¡å·å‘é€è€…çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¸ä¸€å®šæ˜¯æ¥æ”¶è€…çš„çº¿ç¨‹ã€‚</li><li>Queued Connection æ’é˜Ÿè¿æ¥ï¼Œå½“æ§åˆ¶æƒè¿”å›åˆ°æ¥æ”¶æ–¹çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯æ—¶è°ƒç”¨æ§½ã€‚ æ§½å‡½æ•°åœ¨æ¥æ”¶æ–¹çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ä¿¡å·å‘é€è€…å‘é€ä¿¡å·åç«‹å³è¿”å›ï¼Œç›¸å½“äºå¼‚æ­¥è°ƒç”¨</li><li>Blocking Queued Connection é˜»å¡æ’é˜Ÿè¿æ¥ï¼Œæ§½å‡½æ•°åœ¨æ¥æ”¶æ–¹çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ä¿¡å·å‘é€è€…ç­‰å¾…æ§½å‡½æ•°æ‰§è¡Œç»“æŸï¼Œç›¸å½“äºåŒæ­¥è°ƒç”¨ã€‚æ³¨æ„ï¼šä½¿ç”¨è¯¥ç±»å‹è¿æ¥åŒä¸€ä¸ªçº¿ç¨‹ä¸­çš„å¯¹è±¡ä¼šé€ æˆæ­»é”ã€‚</li><li><a href="https://doc.qt.io/qt-6/qt.html#ConnectionType-enum">Unique Connection</a> å”¯ä¸€è¿æ¥ï¼Œè¯¥è¡Œä¸ºä¸è‡ªåŠ¨è¿æ¥ç›¸åŒï¼Œä½†åªæœ‰åœ¨ä¸å¤åˆ¶ç°æœ‰è¿æ¥æ—¶æ‰ä¼šå»ºç«‹è¿æ¥ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç›¸åŒçš„ä¿¡å·å·²ç»è¿æ¥åˆ°åŒä¸€å¯¹å¯¹è±¡çš„ç›¸åŒæ’æ§½ï¼Œåˆ™ä¸ä¼šå»ºç«‹è¿æ¥å¹¶ä¸” connect() è¿”å› falseã€‚æ³¨æ„ï¼šQt::UniqueConnections ä¸é€‚ç”¨äº lambdaã€éæˆå‘˜å‡½æ•°å’Œä»¿å‡½æ•°ï¼›å®ƒä»¬ä»…é€‚ç”¨äºè¿æ¥åˆ°æˆå‘˜å‡½æ•°ã€‚</li></ul><p>å¯ä»¥é€šè¿‡å°†é™„åŠ å‚æ•°ä¼ é€’ç»™ connect() æ¥æŒ‡å®šè¿æ¥ç±»å‹ã€‚ è¯·æ³¨æ„ï¼Œå¦‚æœäº‹ä»¶å¾ªç¯åœ¨æ¥æ”¶æ–¹çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œé‚£ä¹ˆåœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä½äºä¸åŒçº¿ç¨‹ä¸­æ—¶ä½¿ç”¨ç›´æ¥è¿æ¥æ˜¯ä¸å®‰å…¨çš„ï¼ŒåŸå› ä¸è°ƒç”¨ä½äºå¦ä¸€ä¸ªçº¿ç¨‹ä¸­çš„å¯¹è±¡ä¸Šçš„ä»»ä½•å‡½æ•°æ˜¯ä¸å®‰å…¨çš„åŸå› ç›¸åŒã€‚</p><p>QObject::connect() æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Qtå­¦ä¹ -éšå¼å…±äº«</title>
    <link href="/2023/11/12/Qt%E5%AD%A6%E4%B9%A0-%E9%9A%90%E5%BC%8F%E5%85%B1%E4%BA%AB/"/>
    <url>/2023/11/12/Qt%E5%AD%A6%E4%B9%A0-%E9%9A%90%E5%BC%8F%E5%85%B1%E4%BA%AB/</url>
    
    <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€ <a href="https://doc.qt.io/qt-6/implicit-sharing.html">https://doc.qt.io/qt-6/implicit-sharing.html</a></p><p>Qt ä¸­çš„è®¸å¤š C++ ç±»ä½¿ç”¨éšå¼æ•°æ®å…±äº«æ¥æœ€å¤§åŒ–èµ„æºä½¿ç”¨å¹¶æœ€å°åŒ–å¤åˆ¶ã€‚ å½“ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ï¼Œéšå¼å…±äº«ç±»æ—¢å®‰å…¨åˆé«˜æ•ˆï¼Œå› ä¸ºåªä¼ é€’æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆï¼Œå¹¶ä¸”åªæœ‰å½“å‡½æ•°å†™å…¥æ•°æ®æ—¶æ‰ä¼šå¤åˆ¶æ•°æ®ï¼Œå³å†™æ—¶å¤åˆ¶ã€‚</p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>å…±äº«ç±»ç”±æŒ‡å‘åŒ…å«å¼•ç”¨è®¡æ•°å’Œæ•°æ®çš„å…±äº«æ•°æ®å—çš„æŒ‡é’ˆç»„æˆã€‚</p><p>åˆ›å»ºå…±äº«å¯¹è±¡æ—¶ï¼Œå®ƒä¼šå°†å¼•ç”¨è®¡æ•°è®¾ç½®ä¸º 1ã€‚æ¯å½“æ–°å¯¹è±¡å¼•ç”¨å…±äº«æ•°æ®æ—¶ï¼Œå¼•ç”¨è®¡æ•°å°±ä¼šå¢åŠ ï¼Œè€Œå½“å¯¹è±¡å–æ¶ˆå¼•ç”¨å…±äº«æ•°æ®æ—¶ï¼Œå¼•ç”¨è®¡æ•°å°±ä¼šå‡å°‘ã€‚ å½“å¼•ç”¨è®¡æ•°å˜ä¸ºé›¶æ—¶ï¼Œå…±äº«æ•°æ®å°†è¢«åˆ é™¤ã€‚</p><p>åœ¨å¤„ç†å…±äº«å¯¹è±¡æ—¶ï¼Œæœ‰ä¸¤ç§å¤åˆ¶å¯¹è±¡çš„æ–¹æ³•ã€‚ æˆ‘ä»¬é€šå¸¸è¯´æ·±æ‹·è´å’Œæµ…æ‹·è´ã€‚ æ·±æ‹·è´æ„å‘³ç€å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ã€‚ æµ…æ‹·è´æ˜¯å¼•ç”¨æ‹·è´ï¼Œå³åªæ˜¯æŒ‡å‘å…±äº«æ•°æ®å—çš„æŒ‡é’ˆã€‚ å°±å†…å­˜å’Œ CPU è€Œè¨€ï¼Œè¿›è¡Œæ·±æ‹·è´å¯èƒ½ä¼šå¾ˆæ˜‚è´µã€‚ åˆ¶ä½œæµ…æ‹·è´éå¸¸å¿«ï¼Œå› ä¸ºå®ƒåªæ¶‰åŠè®¾ç½®æŒ‡é’ˆå’Œå¢åŠ å¼•ç”¨è®¡æ•°ã€‚</p><p>éšå¼å…±äº«å¯¹è±¡çš„å¯¹è±¡åˆ†é…ï¼ˆä½¿ç”¨ operator=()ï¼‰æ˜¯ä½¿ç”¨æµ…æ‹·è´å®ç°çš„ã€‚</p><p>å…±äº«çš„å¥½å¤„æ˜¯ç¨‹åºä¸éœ€è¦ä¸å¿…è¦åœ°å¤åˆ¶æ•°æ®ï¼Œä»è€Œå‡å°‘å†…å­˜ä½¿ç”¨å’Œæ•°æ®å¤åˆ¶ã€‚å¯¹è±¡å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«èµ‹å€¼ï¼Œä½œä¸ºå‡½æ•°å‚æ•°å‘é€ï¼Œå¹¶ä»å‡½æ•°è¿”å›ã€‚</p><p>éšå¼å…±äº«ä¸»è¦å‘ç”Ÿåœ¨å¹•åï¼›ç¨‹åºå‘˜å¾ˆå°‘éœ€è¦æ‹…å¿ƒå®ƒã€‚ç„¶è€Œï¼ŒQt çš„å®¹å™¨è¿­ä»£å™¨ä¸ STL ä¸­çš„å®¹å™¨è¿­ä»£å™¨æœ‰ä¸åŒçš„è¡Œä¸ºã€‚é˜…è¯»éšå¼å…±äº«è¿­ä»£å™¨é—®é¢˜ï¼ˆåé¢ä¼šè®²ï¼‰ã€‚</p><p>åœ¨å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºä¸­ï¼Œä¼šå‘ç”Ÿéšå¼å…±äº«ï¼Œ<a href="https://doc.qt.io/qt-6/threads-modules.html#threads-and-implicitly-shared-classes">ä½†æ˜¯è¦æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜</a></p><p>åœ¨å®ç°æ‚¨è‡ªå·±çš„éšå¼å…±äº«ç±»æ—¶ï¼Œè¯·ä½¿ç”¨ QSharedData å’Œ QSharedDataPointer ç±»ã€‚</p><h2 id="è¯¦ç»†ä»‹ç»"><a href="#è¯¦ç»†ä»‹ç»" class="headerlink" title="è¯¦ç»†ä»‹ç»"></a>è¯¦ç»†ä»‹ç»</h2><p>å¦‚æœå¯¹è±¡å³å°†æ›´æ”¹å¹¶ä¸”å¼•ç”¨è®¡æ•°å¤§äº 1ï¼Œåˆ™éšå¼å…±äº«ä¼šè‡ªåŠ¨å°†å¯¹è±¡ä»å…±äº«å—ä¸­åˆ†ç¦»å‡ºæ¥ã€‚ ï¼ˆè¿™é€šå¸¸ç§°ä¸ºå†™æ—¶å¤åˆ¶æˆ–å€¼è¯­ä¹‰ã€‚ï¼‰</p><p>éšå¼å…±äº«ç±»å¯ä»¥æ§åˆ¶å…¶å†…éƒ¨æ•°æ®ã€‚ åœ¨ä¿®æ”¹å…¶æ•°æ®çš„ä»»ä½•æˆå‘˜å‡½æ•°ä¸­ï¼Œå®ƒä¼šåœ¨ä¿®æ”¹æ•°æ®ä¹‹å‰è‡ªåŠ¨åˆ†ç¦»ã€‚ ä½†æ˜¯ï¼Œè¯·æ³¨æ„å®¹å™¨è¿­ä»£å™¨çš„ç‰¹æ®Šæƒ…å†µï¼› è¯·å‚é˜…éšå¼å…±äº«è¿­ä»£å™¨é—®é¢˜ã€‚</p><p>ä½¿ç”¨éšå¼å…±äº«çš„ QPen ç±»ä»æ‰€æœ‰æ›´æ”¹å†…éƒ¨æ•°æ®çš„æˆå‘˜å‡½æ•°ä¸­çš„å…±äº«æ•°æ®åˆ†ç¦»ã€‚</p><p>ä»£ç ç‰‡æ®µï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">QPen::setStyle</span><span class="hljs-params">(Qt::PenStyle style)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">detach</span>();           <span class="hljs-comment">// detach from common data</span><br>    d-&gt;style = style;   <span class="hljs-comment">// set the style member</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">QPen::detach</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (d-&gt;ref != <span class="hljs-number">1</span>) &#123;<br>        ...             <span class="hljs-comment">// perform a deep copy</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœå¯¹è±¡å°†è¦æ›´æ”¹ï¼Œä¸‹é¢åˆ—å‡ºçš„ç±»ï¼ˆè§åŸæ–‡ï¼‰ä¼šè‡ªåŠ¨ä»å…¬å…±æ•°æ®ä¸­åˆ†ç¦»å‡ºæ¥ã€‚ ç¨‹åºå‘˜ç”šè‡³ä¸ä¼šæ³¨æ„åˆ°å¯¹è±¡æ˜¯å…±äº«çš„ã€‚ å› æ­¤ï¼Œæ‚¨åº”è¯¥å°†å®ƒä»¬çš„å•ç‹¬å®ä¾‹è§†ä¸ºå•ç‹¬çš„å¯¹è±¡ã€‚ å®ƒä»¬å°†å§‹ç»ˆè¡¨ç°ä¸ºç‹¬ç«‹çš„å¯¹è±¡ï¼Œä½†å…·æœ‰å°½å¯èƒ½å…±äº«æ•°æ®çš„é¢å¤–å¥½å¤„ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥æŒ‰å€¼å°†è¿™äº›ç±»çš„å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œè€Œæ— éœ€æ‹…å¿ƒå¤åˆ¶å¼€é”€ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++">QPixmap p1, p2;<br>p1.<span class="hljs-built_in">load</span>(<span class="hljs-string">&quot;image.bmp&quot;</span>);<br>p2 = p1;                        <span class="hljs-comment">// p1 and p2 share data</span><br><br>QPainter paint;<br>paint.<span class="hljs-built_in">begin</span>(&amp;p2);               <span class="hljs-comment">// cuts p2 loose from p1</span><br>paint.<span class="hljs-built_in">drawText</span>(<span class="hljs-number">0</span>,<span class="hljs-number">50</span>, <span class="hljs-string">&quot;Hi&quot;</span>);<br>paint.<span class="hljs-built_in">end</span>();<br></code></pre></td></tr></table></figure><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œp1 å’Œ p2 å…±äº«æ•°æ®ç›´åˆ°ä¸º p2 è°ƒç”¨ QPainter::begin()ï¼Œå› ä¸ºç»˜åˆ¶åƒç´ å›¾å°†ä¿®æ”¹å®ƒã€‚</p><h2 id="éšå¼å…±äº«è¿­ä»£å™¨é—®é¢˜"><a href="#éšå¼å…±äº«è¿­ä»£å™¨é—®é¢˜" class="headerlink" title="éšå¼å…±äº«è¿­ä»£å™¨é—®é¢˜"></a>éšå¼å…±äº«è¿­ä»£å™¨é—®é¢˜</h2><p>éšå¼å…±äº«å¯¹ STL æ ·å¼çš„è¿­ä»£å™¨æœ‰å¦ä¸€ä¸ªå½±å“ï¼šå½“è¿­ä»£å™¨åœ¨å®¹å™¨ä¸Šå¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œæ‚¨åº”è¯¥é¿å…å¤åˆ¶å®¹å™¨ã€‚ è¿­ä»£å™¨æŒ‡å‘ä¸€ä¸ªå†…éƒ¨ç»“æ„ï¼Œå¦‚æœä½ å¤åˆ¶ä¸€ä¸ªå®¹å™¨ï¼Œä½ åº”è¯¥éå¸¸å°å¿ƒä½ çš„è¿­ä»£å™¨ã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++">QList&lt;<span class="hljs-type">int</span>&gt; a, b;<br>a.<span class="hljs-built_in">resize</span>(<span class="hljs-number">100000</span>); <span class="hljs-comment">// make a big list filled with 0.</span><br><br>QList&lt;<span class="hljs-type">int</span>&gt;::iterator i = a.<span class="hljs-built_in">begin</span>();<br><span class="hljs-comment">// WRONG way of using the iterator i:</span><br>b = a; <span class="hljs-comment">// æ­¤æ—¶bå’Œaå…±äº«æ•°æ®</span><br><br>a[<span class="hljs-number">0</span>] = <span class="hljs-number">5</span>; <br><span class="hljs-comment">// ä¿®æ”¹äº†açš„æ•°æ®ï¼Œaæ‹·è´äº†ä¸€ä»½ï¼Œä»å…±äº«æ•°æ®åˆ†ç¦»</span><br><span class="hljs-comment">// ä½†æ˜¯iä»ç„¶æŒ‡å‘å…±äº«æ•°æ®ï¼Œå³æ­¤æ—¶åªæŒ‡å‘b</span><br><br>b.<span class="hljs-built_in">clear</span>(); <span class="hljs-comment">// æ­¤æ—¶ i æ— æ•ˆ</span><br><br><span class="hljs-type">int</span> j = *i; <span class="hljs-comment">// è¯»å–æ— æ•ˆæ•°æ®ï¼Œå¯èƒ½ä¼šå¯¼è‡´crash</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    The data from b (which i pointed to) is gone.</span><br><span class="hljs-comment">    This would be well-defined with STL containers (and (*i) == 5),</span><br><span class="hljs-comment">    but with QList this is likely to crash.</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¤ºä¾‹ä»…æ˜¾ç¤ºäº† QList çš„é—®é¢˜ï¼Œä½†æ‰€æœ‰éšå¼å…±äº«çš„ Qt å®¹å™¨éƒ½å­˜åœ¨è¯¥é—®é¢˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Qtå­¦ä¹ -D-Pointer</title>
    <link href="/2023/11/12/Qt%E5%AD%A6%E4%B9%A0-D-Pointer/"/>
    <url>/2023/11/12/Qt%E5%AD%A6%E4%B9%A0-D-Pointer/</url>
    
    <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€ <a href="https://wiki.qt.io/D-Pointer">https://wiki.qt.io/D-Pointer</a></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>d-pointæ˜¯Qtçš„ä¸€ç§ä»£ç è®¾è®¡æ¨¡å¼ï¼Œå¯ä»¥ä½¿åº“çš„å®ç°ç»†èŠ‚å¯èƒ½å¯¹å…¶ç”¨æˆ·éšè—ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸ç ´åäºŒè¿›åˆ¶å…¼å®¹æ€§ï¼ˆBinary compatibilityï¼‰çš„æƒ…å†µä¸‹å¯¹åº“è¿›è¡Œå®ç°æ›´æ”¹</p><h2 id="äºŒè¿›åˆ¶å…¼å®¹"><a href="#äºŒè¿›åˆ¶å…¼å®¹" class="headerlink" title="äºŒè¿›åˆ¶å…¼å®¹"></a>äºŒè¿›åˆ¶å…¼å®¹</h2><p>sdkåº“å‡çº§åï¼ŒåŠ¨æ€é“¾æ¥è¯¥åº“çš„æŸä¸ªappä¸å¿…é‡æ–°ç¼–è¯‘ï¼Œä»ç„¶å¯ä»¥è¿è¡Œï¼Œå¯ä»¥è®¤ä¸ºè¯¥åº“æ˜¯äºŒè¿›åˆ¶å…¼å®¹çš„</p><p>æŸäº›æƒ…å†µä¸‹ä¼šç ´åäºŒè¿›åˆ¶å…¼å®¹æ€§ï¼Œä¾‹å¦‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span><br> &#123;<br> <span class="hljs-comment">// ...</span><br> <span class="hljs-keyword">private</span>:<br>    Rect m_geometry;<br> &#125;;<br> <br> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Label</span> : <span class="hljs-keyword">public</span> Widget<br> &#123;<br> <span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// ... </span><br>    <span class="hljs-function">String <span class="hljs-title">text</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> m_text;<br>    &#125;<br> <br> <span class="hljs-keyword">private</span>:<br>     String m_text;<br> &#125;;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç å‘å¸ƒä¸º<em>WidgetLib 1.0</em>.</p><p>è€Œåœ¨WidgetLib 1.1ç‰ˆæœ¬ä¸­ï¼Œåœ¨Widgetç±»ä¸­å¢åŠ äº†æˆå‘˜å˜é‡m_stylesheet</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span><br> &#123;<br>    <span class="hljs-comment">// ...</span><br> <span class="hljs-keyword">private</span>:<br>     Rect m_geometry;<br>     String m_stylesheet; <span class="hljs-comment">// NEW in WidgetLib 1.1</span><br> &#125;;<br> <br> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Label</span> : <span class="hljs-keyword">public</span> Widget<br> &#123;<br> <span class="hljs-keyword">public</span>:<br>     <span class="hljs-comment">// ...</span><br>     <span class="hljs-function">String <span class="hljs-title">text</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function">     </span>&#123;<br>         <span class="hljs-keyword">return</span> m_text;<br>     &#125;<br> <br> <span class="hljs-keyword">private</span>:<br>     String m_text;<br> &#125;;<br></code></pre></td></tr></table></figure><p>å‡çº§ä¸ºWidgetLib 1.1åï¼ŒåŸæ¥ä½¿ç”¨WidgetLib 1.0çš„appå°±ä¼šcrash</p><p>åŸå› æ˜¯é€šè¿‡æ·»åŠ ä¸€ä¸ªæ–°çš„æ•°æ®æˆå‘˜ï¼Œæˆ‘ä»¬æœ€ç»ˆæ”¹å˜äº† Widget å’Œ Label å¯¹è±¡çš„å¤§å°ã€‚å½“C++ ç¼–è¯‘å™¨ç”Ÿæˆä»£ç æ—¶ï¼Œå®ƒä½¿ç”¨åç§»é‡æ¥è®¿é—®å¯¹è±¡å†…çš„æ•°æ®ã€‚</p><table><thead><tr><th align="center">Label object layout in WidgetLib 1.0</th><th align="center">Label object layout in WidgetLib 1.1</th></tr></thead><tbody><tr><td align="center">m_geometry &lt;offset 0&gt;</td><td align="center">m_geometry &lt;offset 0&gt;</td></tr><tr><td align="center">- - -</td><td align="center">m_stylesheet &lt;offset 1&gt;</td></tr><tr><td align="center">m_text &lt;offset 1&gt;</td><td align="center">- - -</td></tr><tr><td align="center">- - -</td><td align="center">m_text &lt;offset 2&gt;</td></tr></tbody></table><p>Label::text()åŸæ¥è®¿é—®çš„offset 1çš„ä½ç½®m_textï¼Œç°åœ¨æ˜¯m_stylesheetçš„ä½ç½®ï¼Œå°±ä¼šcrash</p><p>è‡³äºä¸ºä»€ä¹ˆ Label::text() çš„åç§»é‡è®¡ç®—ä»£ç æœ€ç»ˆå‡ºç°åœ¨ CuteApp äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è€Œä¸æ˜¯ WidgetLib äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚ ç­”æ¡ˆæ˜¯ Label::text() çš„ä»£ç æ˜¯åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰çš„ï¼Œç¼–è¯‘å™¨æœ€ç»ˆå°†å…¶å†…è”ã€‚</p><p>å¦‚æœLabel::text()ä¸æ˜¯å†…è”çš„ï¼Œä¹Ÿä¼šæœ‰é—®é¢˜ã€‚C++ ç¼–è¯‘å™¨ä¾èµ–äºå¯¹è±¡çš„å¤§å°åœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶ç›¸åŒã€‚ ä¾‹å¦‚ï¼Œå †æ ˆå·ç»•/å±•å¼€â€”â€”å¦‚æœæ‚¨åœ¨å †æ ˆä¸Šåˆ›å»ºäº†ä¸€ä¸ª Label å¯¹è±¡ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä»£ç ä»¥åœ¨ç¼–è¯‘æ—¶æ ¹æ® Label çš„å¤§å°åœ¨å †æ ˆä¸Šåˆ†é…ç©ºé—´ã€‚ ç”±äº Label çš„å¤§å°åœ¨ WidgetLib 1.1 çš„è¿è¡Œæ—¶æ˜¯ä¸åŒçš„ï¼ŒLabel çš„æ„é€ å‡½æ•°ä¼šè¦†ç›–ç°æœ‰çš„å †æ ˆæ•°æ®å¹¶æœ€ç»ˆç ´åå †æ ˆã€‚</p><p>æ€»ä¹‹ï¼Œä¸€æ—¦æ‚¨çš„åº“å‘å¸ƒï¼Œ<strong>æ°¸è¿œä¸è¦æ›´æ”¹å¯¼å‡ºçš„ï¼ˆå³å¯¹ç”¨æˆ·å¯è§çš„ï¼‰C++ ç±»çš„å¤§å°æˆ–å¸ƒå±€ï¼ˆä¸è¦å››å¤„ç§»åŠ¨æ•°æ®ï¼‰</strong>ã€‚ C++ ç¼–è¯‘å™¨ç”Ÿæˆä»£ç æ—¶å‡å®šç±»ä¸­æ•°æ®çš„å¤§å°æˆ–é¡ºåºåœ¨ç¼–è¯‘åº”ç”¨ç¨‹åºåä¸ä¼šæ”¹å˜ã€‚</p><h2 id="d-point"><a href="#d-point" class="headerlink" title="d-point"></a>d-point</h2><p>è¯€çªæ˜¯é€šè¿‡ä»…å­˜å‚¨å•ä¸ªæŒ‡é’ˆæ¥ä¿æŒåº“çš„æ‰€æœ‰å…¬å…±ç±»çš„å¤§å°ä¸å˜ã€‚ è¯¥æŒ‡é’ˆæŒ‡å‘åŒ…å«æ‰€æœ‰æ•°æ®çš„ç§æœ‰/å†…éƒ¨æ•°æ®ç»“æ„ã€‚ è¿™ä¸ªå†…éƒ¨ç»“æ„çš„å¤§å°å¯ä»¥æ”¶ç¼©æˆ–å¢é•¿è€Œä¸ä¼šå¯¹åº”ç”¨ç¨‹åºäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼Œå› ä¸ºæŒ‡é’ˆä»…åœ¨åº“ä»£ç ä¸­è®¿é—®ï¼Œå¹¶ä¸”ä»åº”ç”¨ç¨‹åºçš„è§’åº¦æ¥çœ‹ï¼Œå¯¹è±¡çš„å¤§å°æ°¸è¿œä¸ä¼šæ”¹å˜ - å®ƒå§‹ç»ˆæ˜¯æŒ‡é’ˆã€‚ è¯¥æŒ‡é’ˆç§°ä¸º d æŒ‡é’ˆï¼ˆd-pointï¼‰ã€‚</p><p>ä»¥ä¸‹æ˜¯å…¶å®ç°ä»£ç </p><p><strong>widget.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WidgetPrivate</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span><br>&#123;<br>   <span class="hljs-comment">// ...</span><br>   <span class="hljs-function">Rect <span class="hljs-title">geometry</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>   <span class="hljs-comment">// ... </span><br><br><span class="hljs-keyword">private</span>:<br>   WidgetPrivate *d_ptr;<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™é‡ŒWidgetPrivateä½œä¸ºå†…éƒ¨ç±»ï¼Œä¸åŒ…å«å…¶å¤´æ–‡ä»¶ï¼Œä»…åšå‰ç½®å£°æ˜</p><p><strong>widget_p.h</strong>ï¼ŒWidgetPrivateç±»çš„å¤´æ–‡ä»¶</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WidgetPrivate</span><br>&#123;<br>    Rect geometry;<br>    String stylesheet;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>widget.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;widget_p.h&quot;</span></span><br><br>Widget::<span class="hljs-built_in">Widget</span>() : <span class="hljs-built_in">d_ptr</span>(<span class="hljs-keyword">new</span> WidgetPrivate)<br>&#123;<br>    <span class="hljs-comment">// Creation of private data</span><br>&#125;<br><br><span class="hljs-function">Rect <span class="hljs-title">Widget::geometry</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// The d-ptr is only accessed in the library code</span><br>    <span class="hljs-keyword">return</span> d_ptr-&gt;geometry;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œ#include â€œwidget_p.hâ€</p><p>Labelç±»ç»§æ‰¿Widgetç±»ï¼ŒLabelç±»ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰ç±»LabelPrivate</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Label</span> : <span class="hljs-keyword">public</span> Widget<br>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-function">String <span class="hljs-title">text</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-comment">// Each class maintains its own d-pointer</span><br>    LabelPrivate *d_ptr;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>label.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// Unlike WidgetPrivate, the author decided LabelPrivate</span><br><span class="hljs-comment">// to be defined in the source file itself</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LabelPrivate</span><br>&#123;<br>    String text;<br>&#125;;<br><br>Label::<span class="hljs-built_in">Label</span>() : <span class="hljs-built_in">d_ptr</span>(<span class="hljs-keyword">new</span> LabelPrivate)<br>&#123;<br>&#125;<br><br><span class="hljs-function">String <span class="hljs-title">Label::text</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> d_ptr-&gt;text;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°ç»“æ„ï¼Œapp æ°¸è¿œä¸ä¼šç›´æ¥è®¿é—® d æŒ‡é’ˆã€‚ç”±äº d æŒ‡é’ˆä»…åœ¨ WidgetLib ä¸­è®¿é—®ï¼Œå¹¶ä¸” WidgetLib ä¼šåœ¨æ¯æ¬¡å‘å¸ƒæ—¶é‡æ–°ç¼–è¯‘ï¼Œå› æ­¤ Private ç±»å¯ä»¥è‡ªç”±æ›´æ”¹ï¼Œè€Œä¸ä¼šå½±å“ appã€‚</p><p>ä½¿ç”¨d-pointè¿˜æœ‰å…¶ä»–çš„å¥½å¤„</p><ul><li>éšè—äº†å®ç°ç»†èŠ‚â€”â€”æˆ‘ä»¬å¯ä»¥ä»…å°† WidgetLib ä¸å¤´æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸€èµ·å‘å¸ƒã€‚ .cpp æ–‡ä»¶å¯ä»¥æ˜¯å°é—­æºä»£ç ã€‚</li><li>å¤´æ–‡ä»¶æ²¡æœ‰å®ç°ç»†èŠ‚ï¼Œå¯ä»¥ä½œä¸º API å‚è€ƒã€‚</li><li>ç”±äºå®ç°æ‰€éœ€çš„å¤´æ–‡ä»¶å·²ä»å¤´æ–‡ä»¶ç§»åŠ¨åˆ°å®ç°ï¼ˆæºï¼‰æ–‡ä»¶ä¸­ï¼Œå› æ­¤ç¼–è¯‘é€Ÿåº¦è¦å¿«å¾—å¤šã€‚</li></ul><h2 id="q-point"><a href="#q-point" class="headerlink" title="q-point"></a>q-point</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªçœ‹åˆ°äº† d æŒ‡é’ˆä½œä¸º C é£æ ¼çš„æ•°æ®ç»“æ„ã€‚ å®é™…ä¸Šï¼Œå®ƒåŒ…å«ç§æœ‰æ–¹æ³•ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰ã€‚ ä¾‹å¦‚ï¼ŒLabelPrivate å¯èƒ½æœ‰ä¸€ä¸ª getLinkTargetFromPoint() è¾…åŠ©å‡½æ•°ï¼Œå•å‡»é¼ æ ‡æ—¶éœ€è¦å®ƒæ¥æŸ¥æ‰¾é“¾æ¥ç›®æ ‡ã€‚ åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™äº›è¾…åŠ©æ–¹æ³•éœ€è¦è®¿é—®å…¬å…±ç±»ï¼Œå³ä¸€äº›æ¥è‡ª Label æˆ–å…¶åŸºç±» Widget çš„å‡½æ•°ã€‚ ä¾‹å¦‚ï¼Œè¾…åŠ©æ–¹æ³• setTextAndUpdateWidget() å¯èƒ½éœ€è¦è°ƒç”¨ Widget::update()ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¬å…±æ–¹æ³•æ¥å®‰æ’é‡ç»˜ Widgetã€‚ å› æ­¤ï¼Œ<strong>WidgetPrivate å­˜å‚¨äº†ä¸€ä¸ªæŒ‡å‘å…¬å…±ç±»çš„æŒ‡é’ˆï¼Œç§°ä¸º q æŒ‡é’ˆï¼ˆq-pointï¼‰</strong>ã€‚ ä¸º q æŒ‡é’ˆä¿®æ”¹ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p><p><strong>widget.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WidgetPrivate</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span><br>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-function">Rect <span class="hljs-title">geometry</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-comment">// ...</span><br><span class="hljs-keyword">private</span>:<br>    WidgetPrivate *d_ptr;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>widget_p.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WidgetPrivate</span><br>&#123;<br>    <span class="hljs-comment">// Constructor that initializes the q-ptr</span><br>    <span class="hljs-built_in">WidgetPrivate</span>(Widget *q) : <span class="hljs-built_in">q_ptr</span>(q) &#123; &#125;<br>    Widget *q_ptr; <span class="hljs-comment">// q-ptr points to the API class</span><br>    Rect geometry;<br>    String stylesheet;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>widget.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;widget_p.h&quot;</span></span><br><span class="hljs-comment">// Create private data.</span><br><span class="hljs-comment">// Pass the &#x27;this&#x27; pointer to initialize the q-ptr</span><br>Widget::<span class="hljs-built_in">Widget</span>() : <span class="hljs-built_in">d_ptr</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">WidgetPrivate</span>(<span class="hljs-keyword">this</span>))<br>&#123;<br>&#125;<br><br><span class="hljs-function">Rect <span class="hljs-title">Widget::geometry</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// the d-ptr is only accessed in the library code</span><br>    <span class="hljs-keyword">return</span> d_ptr-&gt;geometry;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>label.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Label</span> : <span class="hljs-keyword">public</span> Widget<br>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-function">String <span class="hljs-title">text</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    LabelPrivate *d_ptr;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>label.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LabelPrivate</span><br>&#123;<br>    <span class="hljs-built_in">LabelPrivate</span>(Label *q) : <span class="hljs-built_in">q_ptr</span>(q) &#123; &#125;<br>    Label *q_ptr;<br>    String text;<br>&#125;;<br><br>Label::<span class="hljs-built_in">Label</span>() : <span class="hljs-built_in">d_ptr</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">LabelPrivate</span>(<span class="hljs-keyword">this</span>))<br>&#123;<br>&#125;<br><br><span class="hljs-function">String <span class="hljs-title">Label::text</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> d_ptr-&gt;text;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåˆ›å»ºå•ä¸ª Label å¯¼è‡´ä¸º LabelPrivate å’Œ WidgetPrivate åˆ†é…å†…å­˜ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤º</p><img src="/Users/yuhong/Library/Application Support/typora-user-images/image-20230422225911213.png" alt="image-20230422225911213" style="zoom:50%;" /><p>å¦‚æœæˆ‘ä»¬å¯¹ Qt é‡‡ç”¨è¿™ç§ç­–ç•¥ï¼Œå¯¹äºåƒ QListWidget è¿™æ ·çš„ç±»ï¼Œæƒ…å†µä¼šå˜å¾—æ›´ç³Ÿâ€”â€”å®ƒåœ¨ç±»ç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­æœ‰ 6 å±‚æ·±ï¼Œè¿™å°†å¯¼è‡´å¤šè¾¾ 6 æ¬¡å†…å­˜åˆ†é…ï¼</p><p>å¯ä»¥é€šè¿‡ç§æœ‰ç±»è®¾ç½®ç»§æ‰¿å±‚æ¬¡ç»“æ„å¹¶è®©å®ä¾‹åŒ–çš„ç±»ä¸€ç›´å‘ä¸Šä¼ é€’ d æŒ‡é’ˆæ¥ä¼˜åŒ–</p><p>è¯·æ³¨æ„ï¼Œåœ¨ç»§æ‰¿ d æŒ‡é’ˆæ—¶ï¼Œç§æœ‰ç±»çš„å£°æ˜å¿…é¡»åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚ widget_p.hã€‚ä¸å†å¯èƒ½åœ¨ widget.cpp æ–‡ä»¶ä¸­å£°æ˜å®ƒã€‚</p><p><strong>widget.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Widget</span>();<br>    <span class="hljs-comment">// ...</span><br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-comment">// only subclasses may access the below</span><br>    <span class="hljs-comment">// allow subclasses to initialize with their own concrete Private</span><br>    <span class="hljs-built_in">Widget</span>(WidgetPrivate &amp;d);<br>    WidgetPrivate *d_ptr;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>widget_p.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WidgetPrivate</span><br>&#123;<br>    <span class="hljs-built_in">WidgetPrivate</span>(Widget *q) : <span class="hljs-built_in">q_ptr</span>(q) &#123; &#125; <span class="hljs-comment">// constructor that initializes the q-ptr</span><br>    Widget *q_ptr; <span class="hljs-comment">// q-ptr that points to the API class</span><br>    Rect geometry;<br>    String stylesheet;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>widget.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++">Widget::<span class="hljs-built_in">Widget</span>() : <span class="hljs-built_in">d_ptr</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">WidgetPrivate</span>(<span class="hljs-keyword">this</span>))<br>&#123;<br>&#125;<br><br>Widget::<span class="hljs-built_in">Widget</span>(WidgetPrivate &amp;d) : <span class="hljs-built_in">d_ptr</span>(&amp;d)<br>&#123;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>label.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Label</span> : <span class="hljs-keyword">public</span> Widget<br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Label</span>();<br>    <span class="hljs-comment">// ...</span><br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-built_in">Label</span>(LabelPrivate &amp;d); <span class="hljs-comment">// allow Label subclasses to pass on their Private</span><br>    <span class="hljs-comment">// notice how Label does not have a d_ptr! It just uses Widget&#x27;s d_ptr.</span><br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>label.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;widget_p.h&quot;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LabelPrivate</span> : <span class="hljs-keyword">public</span> WidgetPrivate<br>&#123;<br><span class="hljs-keyword">public</span>:<br>    String text;<br>&#125;;<br><br>Label::<span class="hljs-built_in">Label</span>()<br> : <span class="hljs-built_in">Widget</span>(*<span class="hljs-keyword">new</span> LabelPrivate) <span class="hljs-comment">// initialize the d-pointer with our own Private</span><br>&#123;<br>&#125;<br><br>Label::<span class="hljs-built_in">Label</span>(LabelPrivate &amp;d) : <span class="hljs-built_in">Widget</span>(d)<br>&#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ç°åœ¨åˆ›å»ºä¸€ä¸ª Label å¯¹è±¡æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª LabelPrivateï¼ˆå®ƒæ˜¯ WidgetPrivate çš„å­ç±»ï¼‰ã€‚ å®ƒå°†å…·ä½“çš„ d æŒ‡é’ˆä¼ é€’ç»™ Widget çš„å—ä¿æŠ¤æ„é€ å‡½æ•°ï¼ ç°åœ¨ï¼Œå½“åˆ›å»ºä¸€ä¸ª Label å¯¹è±¡æ—¶ï¼Œåªæœ‰ä¸€æ¬¡å†…å­˜åˆ†é…ã€‚ Label è¿˜æœ‰ä¸€ä¸ªå—ä¿æŠ¤çš„æ„é€ å‡½æ•°ï¼Œå®ƒçš„å­ç±»å¯ä»¥ä½¿ç”¨å®ƒæ¥æä¾›è‡ªå·±çš„ç§æœ‰ç±»ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º</p><img src="/Users/yuhong/Library/Application Support/typora-user-images/image-20230422230845253.png" alt="image-20230422230845253" style="zoom:50%;" /><h2 id="Qtä¸­çš„dæŒ‡é’ˆ"><a href="#Qtä¸­çš„dæŒ‡é’ˆ" class="headerlink" title="Qtä¸­çš„dæŒ‡é’ˆ"></a>Qtä¸­çš„dæŒ‡é’ˆ</h2><p>åœ¨ Qt ä¸­ï¼Œå‡ ä¹æ¯ä¸ªå…¬å…±ç±»éƒ½ä½¿ç”¨ d æŒ‡é’ˆæ–¹æ³•ã€‚ å”¯ä¸€ä¸ä½¿ç”¨å®ƒçš„æƒ…å†µæ˜¯äº‹å…ˆçŸ¥é“è¯¥ç±»æ°¸è¿œä¸ä¼šæ·»åŠ é¢å¤–çš„æˆå‘˜å˜é‡ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºåƒ QPointã€QRect è¿™æ ·çš„ç±»ï¼Œä¸éœ€è¦æ·»åŠ æ–°æˆå‘˜ï¼Œå› æ­¤æ•°æ®æˆå‘˜ç›´æ¥å­˜å‚¨åˆ°ç±»æœ¬èº«è€Œä¸æ˜¯ä½¿ç”¨ d æŒ‡é’ˆã€‚</p><p>è¯·æ³¨æ„ï¼Œåœ¨ Qt ä¸­ï¼Œæ‰€æœ‰ Private å¯¹è±¡çš„åŸºç±»éƒ½æ˜¯ QObjectPrivateã€‚</p><h3 id="Q-D-and-Q-Q"><a href="#Q-D-and-Q-Q" class="headerlink" title="Q_D and Q_Q"></a>Q_D and Q_Q</h3><p>æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥ä¸­è¿›è¡Œçš„ä¼˜åŒ–çš„ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯ q-ptr å’Œ d-ptr æ˜¯ Widget å’Œ WidgetPrivate ç±»å‹ã€‚è¿™æ„å‘³ç€ä»¥ä¸‹å°†ä¸èµ·ä½œç”¨ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Label::setText</span><span class="hljs-params">(<span class="hljs-type">const</span> String &amp;text)</span></span><br><span class="hljs-function"></span>&#123;<br>   <span class="hljs-comment">// won&#x27;t work! since d_ptr is of type WidgetPrivate even though</span><br>   <span class="hljs-comment">// it points to LabelPrivate object</span><br>   d_ptr-&gt;text = text;<br>&#125;<br></code></pre></td></tr></table></figure><p>å› æ­¤ï¼Œå½“è®¿é—®å­ç±»ä¸­çš„ d æŒ‡é’ˆæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°† static_cast è½¬æ¢ä¸ºé€‚å½“çš„ç±»å‹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Label::setText</span><span class="hljs-params">(<span class="hljs-type">const</span> String &amp;text)</span></span><br><span class="hljs-function"></span>&#123;<br>    LabelPrivate *d = <span class="hljs-built_in">static_cast</span>&lt;LabelPrivate*&gt;(d_ptr); <span class="hljs-comment">// cast to our private type</span><br>    d-&gt;text = text;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æ‚¨æ‰€è§ï¼Œåˆ°å¤„éƒ½æ˜¯ static_cast å¹¶ä¸æ˜¯ä¸€ä»¶å¥½äº‹ã€‚ç›¸åï¼Œåœ¨ src/corelib/global/qglobal.h ä¸­å®šä¹‰äº†ä¸¤ä¸ªå®ï¼Œè¿™ä½¿å¾—å®ƒå˜å¾—ç›´æˆªäº†å½“</p><p><strong>global.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">define</span> Q_D(Class) Class##Private * const d = d_func()</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> Q_Q(Class) Class * const q = q_func()</span><br></code></pre></td></tr></table></figure><p><strong>label.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// With Q_D you can use the members of LabelPrivate from Label</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Label::setText</span><span class="hljs-params">(<span class="hljs-type">const</span> String &amp;text)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">Q_D</span>(Label);<br>    d-&gt;text = text;<br>&#125;<br><br><span class="hljs-comment">// With Q_Q you can use the members of Label from LabelPrivate</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">LabelPrivate::someHelperFunction</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">Q_Q</span>(Label);<br>    q-&gt;<span class="hljs-built_in">selectAll</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Q-DECLARE-PRIVATE-and-Q-DECLARE-PUBLIC"><a href="#Q-DECLARE-PRIVATE-and-Q-DECLARE-PUBLIC" class="headerlink" title="Q_DECLARE_PRIVATE and Q_DECLARE_PUBLIC"></a>Q_DECLARE_PRIVATE and Q_DECLARE_PUBLIC</h3><p>Qt ç±»åœ¨å…¬å…±ç±»ä¸­æœ‰ä¸€ä¸ª Q_DECLARE_PRIVATE å®ã€‚å®æ˜¯è¿™ä¹ˆå†™çš„ï¼š</p><p><strong>qglobal.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">define</span> Q_DECLARE_PRIVATE(Class)\</span><br><span class="hljs-meta">inline Class##Private* d_func() &#123;\</span><br><span class="hljs-meta">    return reinterpret_cast<span class="hljs-string">&lt;Class##Private *&gt;</span>(qGetPtrHelper(d_ptr));\</span><br><span class="hljs-meta">&#125;\</span><br><span class="hljs-meta">inline const Class##Private* d_func() const &#123;\</span><br><span class="hljs-meta">    return reinterpret_cast<span class="hljs-string">&lt;const Class##Private *&gt;</span>(qGetPtrHelper(d_ptr));\</span><br><span class="hljs-meta">&#125;\</span><br><span class="hljs-meta">friend class Class##Private;</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> Q_DECLARE_PUBLIC(Class)                                    \</span><br><span class="hljs-meta">inline Class* q_func() &#123; return static_cast<span class="hljs-string">&lt;Class *&gt;</span>(q_ptr); &#125; \</span><br><span class="hljs-meta">inline const Class* q_func() const &#123; return static_cast<span class="hljs-string">&lt;const Class *&gt;</span>(q_ptr); &#125; \</span><br><span class="hljs-meta">friend class Class;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå®å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</p><p><strong>qlabel.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QLabel</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-built_in">Q_DECLARE_PRIVATE</span>(QLabel)<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæƒ³æ³•æ˜¯ QLabel æä¾›äº†ä¸€ä¸ªå…è®¸è®¿é—®å…¶ç§æœ‰å†…éƒ¨ç±»çš„å‡½æ•° d_func() ã€‚ è¯¥æ–¹æ³•æœ¬èº«æ˜¯ç§æœ‰çš„ï¼ˆå› ä¸ºå®ä½äº qlabel.h çš„ç§æœ‰éƒ¨åˆ†ä¸­ï¼‰ã€‚ ç„¶è€Œï¼Œd_func() å¯ä»¥è¢« QLabel çš„å‹ç±»è°ƒç”¨ã€‚ è¿™ä¸»è¦ç”¨äºæ— æ³•ä½¿ç”¨å…¬å…± api è®¿é—®æŸäº› QLabel ä¿¡æ¯çš„ Qt ç±»è®¿é—®ä¿¡æ¯ã€‚ ä¸¾ä¸€ä¸ªå¥‡æ€ªçš„ä¾‹å­ï¼ŒQLabel å¯èƒ½ä¼šè·Ÿè¸ªç”¨æˆ·ç‚¹å‡»é“¾æ¥çš„æ¬¡æ•°ã€‚ ä½†æ˜¯ï¼Œæ²¡æœ‰å…¬å…± API æ¥è®¿é—®æ­¤ä¿¡æ¯ã€‚ QStatistics æ˜¯ä¸€ä¸ªéœ€è¦æ­¤ä¿¡æ¯çš„ç±»ã€‚ Qt å¼€å‘äººå‘˜ä¼šå°† QStatistics æ·»åŠ ä¸º QLabel çš„å¥½å‹ï¼Œç„¶å QStatistics å¯ä»¥æ‰§è¡Œ label-&gt;d_func()-&gt;linkClickCountã€‚</p><p>d_func è¿˜å…·æœ‰å¼ºåˆ¶ const æ­£ç¡®æ€§çš„ä¼˜ç‚¹ï¼šåœ¨ MyClass çš„ const æˆå‘˜å‡½æ•°ä¸­ï¼Œæ‚¨éœ€è¦ä¸€ä¸ª Q_D(const MyClass)ï¼Œå› æ­¤æ‚¨åªèƒ½è°ƒç”¨ MyClassPrivate ä¸­çš„ const æˆå‘˜å‡½æ•°ã€‚ ä½¿ç”¨è£¸ d_ptrï¼Œæ‚¨è¿˜å¯ä»¥è°ƒç”¨éå¸¸é‡å‡½æ•°ã€‚</p><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><p><strong>mywidget.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MYWIDGET_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MYWIDGET_H</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QObject&gt;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWidgetPrivate</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWidget</span> : <span class="hljs-keyword">public</span> QObject<br>&#123;<br>    Q_OBJECT<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MyWidget</span><span class="hljs-params">(QObject *parent = <span class="hljs-literal">nullptr</span>)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fun</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">api</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-built_in">Q_DECLARE_PRIVATE</span>(MyWidget)<br>    MyWidgetPrivate *d_ptr;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// MYWIDGET_H</span></span><br></code></pre></td></tr></table></figure><p><strong>mywidget_p.h</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MYWIDGETPRIVATE_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MYWIDGETPRIVATE_H</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QObject&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mywidget.h&quot;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWidgetPrivate</span> : <span class="hljs-keyword">public</span> QObject<br>&#123;<br>    <span class="hljs-function">Q_OBJECT</span><br><span class="hljs-function">    <span class="hljs-title">Q_DECLARE_PUBLIC</span><span class="hljs-params">(MyWidget)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">public</span>:</span><br><span class="hljs-function">    explicit MyWidgetPrivate(QObject *parent =</span> <span class="hljs-literal">nullptr</span>);<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    MyWidget *q_ptr;<br>    QString text;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// MYWIDGETPRIVATE_H</span></span><br><br></code></pre></td></tr></table></figure><p><strong>mywidget.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mywidget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mywidget_p.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QDebug&gt;</span></span><br><br>MyWidget::<span class="hljs-built_in">MyWidget</span>(QObject *parent)<br>    : QObject&#123;parent&#125;, <span class="hljs-built_in">d_ptr</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">MyWidgetPrivate</span>(<span class="hljs-keyword">this</span>))<br><br>&#123;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MyWidget::fun</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">Q_D</span>(MyWidget);<br>    <span class="hljs-keyword">return</span> d-&gt;<span class="hljs-built_in">func</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MyWidget::api</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">qDebug</span>() &lt;&lt; __PRETTY_FUNCTION__;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>mywidget_p.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mywidget_p.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QDebug&gt;</span></span><br><br>MyWidgetPrivate::<span class="hljs-built_in">MyWidgetPrivate</span>(QObject *parent)<br>    : QObject&#123;parent&#125;<br>&#123;<br>    text = <span class="hljs-string">&quot;aaa&quot;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MyWidgetPrivate::func</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">qDebug</span>() &lt;&lt; __PRETTY_FUNCTION__;<br>    <span class="hljs-built_in">Q_Q</span>(MyWidget);<br>    q-&gt;<span class="hljs-built_in">api</span>();<br>    <span class="hljs-built_in">qDebug</span>() &lt;&lt; text;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>main.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mywidget.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br><br>    MyWidget *myWidget = <span class="hljs-keyword">new</span> MyWidget;<br>    myWidget-&gt;<span class="hljs-built_in">fun</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Qt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
